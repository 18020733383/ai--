
import { Troop, TroopTier, Location, TerrainType, PlayerState, RecruitOffer, ParrotVariant, Hero, RaceId, TroopRace, BugSummonRecipe, MineralId, Anomaly } from './types';

export const MAP_WIDTH = 480;
export const MAP_HEIGHT = 480;

export const WORLD_BOOK = [
  '词条：附加规则效果，影响命中、伤害、控制或属性。',
  '技能：兵种自带能力，以【技能：】标记，是战斗关键表现。',
  '第纳尔：通用金币，用于招募、升级、建设与交易。',
  '世界观：世界是一台破旧服务器运行的代码集合，现实像系统日志。',
  '伪人：错误实例化的产物，行为异常、身份不稳定。',
  '魔法水晶：系统 bug 凝结形成的实体，用于附魔或触发异常。'
].join('\n');

export const RACE_LABELS: Record<RaceId, string> = {
  HUMAN: '人类',
  ROACH: '蟑螂族群',
  UNDEAD: '亡灵族群',
  IMPOSTER: '伪人族群',
  BANDIT: '盗匪团伙',
  AUTOMATON: '失控机兵',
  VOID: '深渊势力',
  MADNESS: '疯人群体',
  BEAST: '野兽族群'
};

export const RACE_RELATION_MATRIX: Record<RaceId, Record<RaceId, number>> = {
  HUMAN: {
    HUMAN: 0,
    ROACH: -35,
    UNDEAD: -25,
    IMPOSTER: -80,
    BANDIT: -50,
    AUTOMATON: -30,
    VOID: -60,
    MADNESS: -40,
    BEAST: -10
  },
  ROACH: {
    HUMAN: -35,
    ROACH: 0,
    UNDEAD: -10,
    IMPOSTER: -60,
    BANDIT: -20,
    AUTOMATON: -15,
    VOID: -45,
    MADNESS: -25,
    BEAST: -25
  },
  UNDEAD: {
    HUMAN: -25,
    ROACH: -10,
    UNDEAD: 0,
    IMPOSTER: -55,
    BANDIT: -20,
    AUTOMATON: -20,
    VOID: -40,
    MADNESS: -15,
    BEAST: -5
  },
  IMPOSTER: {
    HUMAN: -80,
    ROACH: -60,
    UNDEAD: -55,
    IMPOSTER: 0,
    BANDIT: -55,
    AUTOMATON: -40,
    VOID: -70,
    MADNESS: -50,
    BEAST: -55
  },
  BANDIT: {
    HUMAN: -50,
    ROACH: -20,
    UNDEAD: -20,
    IMPOSTER: -55,
    BANDIT: 0,
    AUTOMATON: -25,
    VOID: -35,
    MADNESS: -15,
    BEAST: -20
  },
  AUTOMATON: {
    HUMAN: -30,
    ROACH: -15,
    UNDEAD: -20,
    IMPOSTER: -40,
    BANDIT: -25,
    AUTOMATON: 0,
    VOID: -45,
    MADNESS: -25,
    BEAST: -18
  },
  VOID: {
    HUMAN: -60,
    ROACH: -45,
    UNDEAD: -40,
    IMPOSTER: -70,
    BANDIT: -35,
    AUTOMATON: -45,
    VOID: 0,
    MADNESS: -30,
    BEAST: -40
  },
  MADNESS: {
    HUMAN: -40,
    ROACH: -25,
    UNDEAD: -15,
    IMPOSTER: -50,
    BANDIT: -15,
    AUTOMATON: -25,
    VOID: -30,
    MADNESS: 0,
    BEAST: -8
  },
  BEAST: {
    HUMAN: -10,
    ROACH: -25,
    UNDEAD: -5,
    IMPOSTER: -55,
    BANDIT: -20,
    AUTOMATON: -18,
    VOID: -40,
    MADNESS: -8,
    BEAST: 0
  }
};

export const FACTIONS = [
  {
    id: 'VERDANT_COVENANT',
    name: '翠弦盟约',
    shortName: '翠弦',
    description: '由河谷与林地的弓手团结成的盟约，以记录与远射守护贸易脉络。',
    focus: 'RANGED',
    color: '#22c55e',
    specialTroopIds: ['verdant_scout_archer', 'verdant_skybow']
  },
  {
    id: 'FROST_OATH',
    name: '霜誓王庭',
    shortName: '霜誓',
    description: '北境要塞与山岭关隘组成的誓盟，以重装与誓约维系残存秩序。',
    focus: 'MELEE',
    color: '#60a5fa',
    specialTroopIds: ['frost_oath_halberdier', 'frost_oath_bladeguard']
  },
  {
    id: 'RED_DUNE',
    name: '赤沙驭团',
    shortName: '赤沙',
    description: '沙海驿路上的骑团联邦，依靠风暴与驭骑掌控补给线。',
    focus: 'CAVALRY',
    color: '#f97316',
    specialTroopIds: ['red_dune_lancer', 'red_dune_cataphract']
  }
] as const;

const troopAttr = (attack: number, defense: number, agility: number, hp: number, range: number, morale: number) => ({
  attack,
  defense,
  agility,
  hp,
  range,
  morale
});

const clampByte = (value: number) => Math.max(0, Math.min(255, Math.round(value)));

const isLegacyAttributeRange = (attrs: Troop['attributes']) => {
  const values = [attrs.attack, attrs.defense, attrs.agility, attrs.hp, attrs.range, attrs.morale];
  return values.every(v => v >= 0 && v <= 10);
};

const getTierCap = (tier: TroopTier) => {
  switch (tier) {
    case TroopTier.TIER_1:
      return 80;
    case TroopTier.TIER_2:
      return 115;
    case TroopTier.TIER_3:
      return 145;
    case TroopTier.TIER_4:
      return 185;
    case TroopTier.TIER_5:
      return 230;
    default:
      return 145;
  }
};

const normalizeAttributes = (attrs: Troop['attributes'], tier: TroopTier) => {
  if (isLegacyAttributeRange(attrs)) {
    const cap = getTierCap(tier);
    const scale = (value: number) => clampByte((value / 10) * cap);
    return {
      attack: scale(attrs.attack),
      defense: scale(attrs.defense),
      agility: scale(attrs.agility),
      hp: scale(attrs.hp),
      range: scale(attrs.range),
      morale: scale(attrs.morale)
    };
  }

  return {
    attack: clampByte(attrs.attack),
    defense: clampByte(attrs.defense),
    agility: clampByte(attrs.agility),
    hp: clampByte(attrs.hp),
    range: clampByte(attrs.range),
    morale: clampByte(attrs.morale)
  };
};

const RAW_TROOP_TEMPLATES: Record<string, Omit<Troop, 'count' | 'xp'>> = {
  // --- HUMAN TREE ---
  peasant: {
    id: 'peasant',
    name: '农民',
    tier: TroopTier.TIER_1,
    basePower: 5,
    cost: 10,
    upgradeCost: 25,
    maxXp: 20,
    upgradeTargetId: 'militia',
    description: '被迫拿起武器的村民。【技能：人海战术】数量超过50时士气微弱提升。',
    equipment: ['生锈的草叉', '亚麻布衣'],
    attributes: troopAttr(30, 20, 25, 30, 5, 25)
  },
  militia: {
    id: 'militia',
    name: '民兵',
    tier: TroopTier.TIER_2,
    basePower: 15,
    cost: 40,
    upgradeCost: 60,
    maxXp: 50,
    upgradeTargetId: 'footman',
    description: '接受过基础训练的城镇守卫。【技能：坚守】在城镇地形防御力+20%。',
    equipment: ['短矛', '木盾', '皮甲'],
    attributes: troopAttr(65, 55, 50, 60, 5, 60)
  },
  footman: {
    id: 'footman',
    name: '重步兵',
    tier: TroopTier.TIER_3,
    basePower: 35,
    cost: 100,
    upgradeCost: 150,
    maxXp: 120,
    upgradeTargetId: 'knight',
    description: '军队的中坚力量。【技能：盾墙】对抗远程伤害减少50%。',
    equipment: ['精铁剑', '阔盾', '链甲'],
    attributes: troopAttr(100, 100, 60, 110, 5, 80)
  },
  knight: {
    id: 'knight',
    name: '帝国骑士',
    tier: TroopTier.TIER_4,
    basePower: 80,
    cost: 350,
    upgradeCost: 600,
    maxXp: 300,
    upgradeTargetId: 'paladin',
    description: '身披重铠的战场主宰。【技能：雷霆冲锋】第一回合造成双倍伤害，大概率击飞步兵。',
    equipment: ['重型骑枪', '精钢长剑', '全身板甲', '披甲战马'],
    attributes: troopAttr(180, 160, 110, 170, 15, 120)
  },
  paladin: {
    id: 'paladin',
    name: '圣殿护卫',
    tier: TroopTier.TIER_5,
    basePower: 150,
    cost: 1000,
    upgradeCost: 0,
    maxXp: 2000,
    description: '传说中的皇家守卫。【技能：圣域】周围友军免疫恐惧。【连携：神圣誓言】若场上有牧师类单位，每回合自动回复生命。',
    equipment: ['符文巨剑', '振金板甲', '神圣光环'],
    attributes: troopAttr(200, 215, 160, 220, 5, 200)
  },
  imperial_shieldbearer: {
    id: 'imperial_shieldbearer',
    name: '帝国盾卫',
    tier: TroopTier.TIER_2,
    basePower: 22,
    cost: 70,
    upgradeCost: 120,
    maxXp: 80,
    upgradeTargetId: 'footman',
    description: '成列推进的城防主力。【技能：盾阵】受到远程伤害降低。',
    equipment: ['长盾', '短剑', '锁子甲'],
    attributes: troopAttr(75, 85, 50, 80, 5, 75)
  },
  imperial_swordsman: {
    id: 'imperial_swordsman',
    name: '帝国剑士',
    tier: TroopTier.TIER_3,
    basePower: 40,
    cost: 140,
    upgradeCost: 220,
    maxXp: 150,
    upgradeTargetId: 'knight',
    description: '纪律严明的主力步兵。【技能：齐射冲锋】小幅提升近战爆发。',
    equipment: ['帝国长剑', '圆盾', '链甲'],
    attributes: troopAttr(6, 5, 4, 6, 1, 6)
  },
  imperial_crossbowman: {
    id: 'imperial_crossbowman',
    name: '帝国弩手',
    tier: TroopTier.TIER_3,
    basePower: 38,
    cost: 130,
    upgradeCost: 200,
    maxXp: 140,
    upgradeTargetId: 'sharpshooter',
    description: '城墙上的稳定火力。【技能：破甲弩矢】对重甲单位更有效。',
    equipment: ['军用重弩', '穿甲栓', '硬皮甲'],
    attributes: troopAttr(110, 70, 90, 80, 160, 80)
  },
  imperial_shield_conscript: {
    id: 'imperial_shield_conscript',
    name: '帝国持盾征召兵',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 20,
    upgradeCost: 45,
    maxXp: 30,
    upgradeTargetId: 'imperial_phalanx_infantry',
    description: '刚披上盾牌的效力兵。【技能：结阵】相邻有盾兵时受到的近战伤害降低。',
    equipment: ['木包皮盾', '短斧', '厚布甲'],
    attributes: troopAttr(35, 50, 30, 45, 5, 45)
  },
  imperial_phalanx_infantry: {
    id: 'imperial_phalanx_infantry',
    name: '帝国方阵步兵',
    tier: TroopTier.TIER_2,
    basePower: 26,
    cost: 80,
    upgradeCost: 140,
    maxXp: 90,
    upgradeTargetId: 'imperial_guard_heavy',
    description: '方阵推进时如同铁墙。【技能：方阵推进】遭遇骑兵冲锋时伤害降低。',
    equipment: ['包铁方盾', '短剑', '锁子甲'],
    attributes: troopAttr(75, 85, 50, 80, 5, 75)
  },
  imperial_guard_heavy: {
    id: 'imperial_guard_heavy',
    name: '帝国禁卫重步兵',
    tier: TroopTier.TIER_3,
    basePower: 55,
    cost: 190,
    upgradeCost: 320,
    maxXp: 200,
    upgradeTargetId: 'imperial_immortal_wall',
    description: '皇城军械库的产物。【技能：钢壁】受到的远程伤害大幅降低。',
    equipment: ['精钢塔盾', '军团短剑', '鳞甲'],
    attributes: troopAttr(95, 135, 50, 120, 5, 85)
  },
  imperial_immortal_wall: {
    id: 'imperial_immortal_wall',
    name: '帝国不朽者大盾卫',
    tier: TroopTier.TIER_4,
    basePower: 110,
    cost: 550,
    upgradeCost: 0,
    maxXp: 900,
    description: '被铠甲武装到牙齿的防线核心。【技能：不动如山】全队防御提升。',
    equipment: ['巨型方盾', '钉头锤', '整体板甲'],
    attributes: troopAttr(7, 9, 3, 9, 1, 8)
  },
  imperial_recruit_archer: {
    id: 'imperial_recruit_archer',
    name: '帝国新手弓箭手',
    tier: TroopTier.TIER_1,
    basePower: 11,
    cost: 25,
    upgradeCost: 50,
    maxXp: 35,
    upgradeTargetId: 'imperial_longbowman',
    description: '接受帝国射术教材的第一批学员。【技能：校准射击】首轮命中率提升。',
    equipment: ['训练弓', '木箭', '皮护臂'],
    attributes: troopAttr(40, 30, 50, 35, 100, 45)
  },
  imperial_longbowman: {
    id: 'imperial_longbowman',
    name: '帝国长弓手',
    tier: TroopTier.TIER_2,
    basePower: 28,
    cost: 90,
    upgradeCost: 150,
    maxXp: 95,
    upgradeTargetId: 'imperial_marksman',
    description: '拉开长弓就是帝国的压制力。【技能：长弓齐射】对无盾单位伤害提升。',
    equipment: ['长弓', '三棱箭', '镶钉皮甲'],
    attributes: troopAttr(70, 50, 60, 60, 150, 65)
  },
  imperial_marksman: {
    id: 'imperial_marksman',
    name: '帝国神射手',
    tier: TroopTier.TIER_3,
    basePower: 58,
    cost: 210,
    upgradeCost: 330,
    maxXp: 210,
    upgradeTargetId: 'imperial_eagle_ranger',
    description: '只需一箭就能封锁敌军阵线。【技能：穿甲狙击】对重甲造成额外伤害。',
    equipment: ['复合长弓', '穿甲箭', '轻链甲'],
    attributes: troopAttr(115, 70, 90, 80, 175, 80)
  },
  imperial_eagle_ranger: {
    id: 'imperial_eagle_ranger',
    name: '帝国鹰眼游侠',
    tier: TroopTier.TIER_4,
    basePower: 115,
    cost: 600,
    upgradeCost: 0,
    maxXp: 1000,
    description: '帝国远程火力的标尺。【技能：鹰眼压制】命中后降低敌军士气。',
    equipment: ['鹰眼长弓', '尖啸箭', '影纹披风'],
    attributes: troopAttr(155, 100, 140, 110, 210, 120)
  },
  imperial_recruit_crossbow: {
    id: 'imperial_recruit_crossbow',
    name: '帝国弩兵学徒',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 30,
    upgradeCost: 55,
    maxXp: 35,
    upgradeTargetId: 'imperial_light_crossbowman',
    description: '从上弦动作开始学起的新人。【技能：上弦训练】装填时间缩短。',
    equipment: ['轻弩', '木质弩矢', '皮护肩'],
    attributes: troopAttr(45, 30, 35, 40, 100, 45)
  },
  imperial_light_crossbowman: {
    id: 'imperial_light_crossbowman',
    name: '帝国轻弩手',
    tier: TroopTier.TIER_2,
    basePower: 30,
    cost: 95,
    upgradeCost: 160,
    maxXp: 100,
    upgradeTargetId: 'imperial_heavy_crossbowman',
    description: '固定支架确保稳定输出。【技能：支架齐射】站定时命中率提升。',
    equipment: ['军用轻弩', '硬木弩矢', '皮甲'],
    attributes: troopAttr(70, 50, 60, 60, 140, 65)
  },
  imperial_heavy_crossbowman: {
    id: 'imperial_heavy_crossbowman',
    name: '帝国重型弩手',
    tier: TroopTier.TIER_3,
    basePower: 62,
    cost: 230,
    upgradeCost: 360,
    maxXp: 230,
    upgradeTargetId: 'imperial_steel_arbalest',
    description: '钢栓专为重甲而生。【技能：破甲钢栓】对骑兵与重甲伤害提升。',
    equipment: ['重弩', '钢栓', '链甲'],
    attributes: troopAttr(120, 80, 85, 95, 170, 90)
  },
  imperial_steel_arbalest: {
    id: 'imperial_steel_arbalest',
    name: '帝国钢弩校尉',
    tier: TroopTier.TIER_4,
    basePower: 120,
    cost: 650,
    upgradeCost: 0,
    maxXp: 1100,
    description: '代表帝国工艺的极致火力。【技能：三棱贯穿】可穿透多名敌兵。',
    equipment: ['钢臂床弩', '三棱钢栓', '护肩甲'],
    attributes: troopAttr(150, 110, 120, 120, 190, 120)
  },
  imperial_light_attendant: {
    id: 'imperial_light_attendant',
    name: '帝国轻装扈从',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 25,
    upgradeCost: 50,
    maxXp: 35,
    upgradeTargetId: 'imperial_sword_sergeant',
    description: '随军杂役被提拔为破阵预备役。【技能：迅捷突击】接近远程单位更快。',
    equipment: ['短刃', '轻圆盾', '皮甲'],
    attributes: troopAttr(45, 35, 55, 45, 5, 45)
  },
  imperial_sword_sergeant: {
    id: 'imperial_sword_sergeant',
    name: '帝国持剑军士',
    tier: TroopTier.TIER_2,
    basePower: 30,
    cost: 95,
    upgradeCost: 160,
    maxXp: 100,
    upgradeTargetId: 'imperial_executioner',
    description: '专职破盾的军士阶层。【技能：破盾斩】对持盾单位伤害提升。',
    equipment: ['军士长剑', '护臂', '鳞甲'],
    attributes: troopAttr(75, 85, 50, 80, 5, 75)
  },
  imperial_executioner: {
    id: 'imperial_executioner',
    name: '帝国处刑巨剑士',
    tier: TroopTier.TIER_3,
    basePower: 65,
    cost: 240,
    upgradeCost: 380,
    maxXp: 240,
    upgradeTargetId: 'imperial_judicator_greatsword',
    description: '巨剑就是执行命令的法典。【技能：处刑打击】对低血量目标伤害暴增。',
    equipment: ['处刑巨剑', '肩甲', '重鳞甲'],
    attributes: troopAttr(130, 90, 60, 100, 5, 90)
  },
  imperial_judicator_greatsword: {
    id: 'imperial_judicator_greatsword',
    name: '帝国审判大剑',
    tier: TroopTier.TIER_4,
    basePower: 125,
    cost: 680,
    upgradeCost: 0,
    maxXp: 1200,
    description: '帝国之傲，挥剑即判决。【技能：裁决风暴】大范围横扫造成溅射伤害。',
    equipment: ['审判巨刃', '斩首披风', '整体板甲'],
    attributes: troopAttr(180, 150, 120, 160, 5, 140)
  },
  imperial_spear_initiate: {
    id: 'imperial_spear_initiate',
    name: '帝国长枪学徒',
    tier: TroopTier.TIER_1,
    basePower: 11,
    cost: 22,
    upgradeCost: 45,
    maxXp: 35,
    upgradeTargetId: 'imperial_pikeman',
    description: '从拒马训练起步的长枪兵。【技能：拒马】对骑兵冲锋额外伤害。',
    equipment: ['训练长枪', '皮护膝', '轻布甲'],
    attributes: troopAttr(40, 35, 40, 45, 20, 45)
  },
  imperial_pikeman: {
    id: 'imperial_pikeman',
    name: '帝国长枪兵',
    tier: TroopTier.TIER_2,
    basePower: 29,
    cost: 90,
    upgradeCost: 150,
    maxXp: 100,
    upgradeTargetId: 'imperial_breacher_vanguard',
    description: '枪阵如林，专门克骑。【技能：稳固长阵】阵形中不易被击退。',
    equipment: ['长枪', '护肩', '锁子甲'],
    attributes: troopAttr(4, 4, 3, 4, 3, 5)
  },
  imperial_breacher_vanguard: {
    id: 'imperial_breacher_vanguard',
    name: '帝国破阵锐士',
    tier: TroopTier.TIER_3,
    basePower: 60,
    cost: 220,
    upgradeCost: 360,
    maxXp: 230,
    upgradeTargetId: 'imperial_iron_halberd_marshal',
    description: '专为撕开阵线而生。【技能：破阵推进】冲入敌阵时造成士气打击。',
    equipment: ['重型长枪', '护面盔', '重链甲'],
    attributes: troopAttr(125, 100, 65, 110, 20, 90)
  },
  imperial_iron_halberd_marshal: {
    id: 'imperial_iron_halberd_marshal',
    name: '帝国铁血长戟元帅',
    tier: TroopTier.TIER_4,
    basePower: 120,
    cost: 650,
    upgradeCost: 0,
    maxXp: 1100,
    description: '长戟挥舞如同钢铁风暴。【技能：元帅号令】周围友军对骑兵伤害提升。',
    equipment: ['帝国长戟', '指挥披风', '板甲'],
    attributes: troopAttr(8, 6, 5, 7, 3, 7)
  },
  imperial_squire_cavalry: {
    id: 'imperial_squire_cavalry',
    name: '帝国侍从骑兵',
    tier: TroopTier.TIER_1,
    basePower: 13,
    cost: 35,
    upgradeCost: 70,
    maxXp: 40,
    upgradeTargetId: 'imperial_light_cavalry',
    description: '第一次穿上马铠的年轻侍从。【技能：骑枪训练】首次冲锋伤害提升。',
    equipment: ['短骑枪', '轻马甲', '骑兵头盔'],
    attributes: troopAttr(55, 35, 65, 55, 15, 55)
  },
  imperial_light_cavalry: {
    id: 'imperial_light_cavalry',
    name: '帝国轻骑兵',
    tier: TroopTier.TIER_2,
    basePower: 34,
    cost: 120,
    upgradeCost: 200,
    maxXp: 120,
    upgradeTargetId: 'imperial_elite_knight',
    description: '巡边与突袭的主力。【技能：游走冲击】击中后更容易脱离战斗。',
    equipment: ['轻骑枪', '弯刀', '马镫护具'],
    attributes: troopAttr(75, 50, 95, 70, 15, 75)
  },
  imperial_elite_knight: {
    id: 'imperial_elite_knight',
    name: '帝国精锐骑士',
    tier: TroopTier.TIER_3,
    basePower: 75,
    cost: 300,
    upgradeCost: 480,
    maxXp: 280,
    upgradeTargetId: 'imperial_bixi_heavy_cavalry',
    description: '帝国机动战的中坚。【技能：铁蹄冲锋】冲锋时有几率击晕敌人。',
    equipment: ['精钢骑枪', '军团重剑', '鳞甲马铠'],
    attributes: troopAttr(140, 110, 120, 130, 15, 110)
  },
  imperial_bixi_heavy_cavalry: {
    id: 'imperial_bixi_heavy_cavalry',
    name: '帝国狴犴重骑',
    tier: TroopTier.TIER_4,
    basePower: 140,
    cost: 900,
    upgradeCost: 0,
    maxXp: 1500,
    description: '帝国最昂贵的铁骑。【技能：具装碾压】冲锋伤害巨幅提升。',
    equipment: ['重型骑枪', '重铠战剑', '具装战马'],
    attributes: troopAttr(180, 160, 110, 170, 15, 140)
  },
  verdant_scout_archer: {
    id: 'verdant_scout_archer',
    name: '翠弦斥候',
    tier: TroopTier.TIER_2,
    basePower: 34,
    cost: 120,
    upgradeCost: 200,
    maxXp: 120,
    upgradeTargetId: 'verdant_skybow',
    description: '翠弦盟约的林地斥候，用林纹弓标记目标。【技能：风痕瞄线】移动中命中率提升。',
    equipment: ['林纹短弓', '轻鳞护肩', '猎手披风'],
    attributes: troopAttr(70, 50, 90, 70, 140, 80)
  },
  verdant_skybow: {
    id: 'verdant_skybow',
    name: '翠弦天弓',
    tier: TroopTier.TIER_3,
    basePower: 78,
    cost: 320,
    upgradeCost: 520,
    maxXp: 320,
    upgradeTargetId: 'sharpshooter',
    description: '在树冠之上拉弓的神射手。【技能：穿云矢】远距射击暴击率提升。',
    equipment: ['天弓', '青木箭囊', '织叶轻甲'],
    attributes: troopAttr(115, 85, 100, 95, 175, 115)
  },
  frost_oath_halberdier: {
    id: 'frost_oath_halberdier',
    name: '霜誓长戟兵',
    tier: TroopTier.TIER_2,
    basePower: 36,
    cost: 125,
    upgradeCost: 210,
    maxXp: 130,
    upgradeTargetId: 'frost_oath_bladeguard',
    description: '誓约刻在戟柄上，守住关隘不退。【技能：寒誓守线】近战防御提升。',
    equipment: ['霜纹长戟', '重甲护臂', '誓约战袍'],
    attributes: troopAttr(95, 115, 65, 125, 20, 95)
  },
  frost_oath_bladeguard: {
    id: 'frost_oath_bladeguard',
    name: '霜誓刃卫',
    tier: TroopTier.TIER_3,
    basePower: 82,
    cost: 340,
    upgradeCost: 540,
    maxXp: 330,
    upgradeTargetId: 'imperial_iron_halberd_marshal',
    description: '近战核心护卫，盾墙背后只有誓言。【技能：寒锋壁垒】受到远程伤害降低。',
    equipment: ['霜誓长刃', '重型圆盾', '覆霜板甲'],
    attributes: troopAttr(135, 155, 75, 145, 20, 125)
  },
  red_dune_lancer: {
    id: 'red_dune_lancer',
    name: '赤沙枪骑',
    tier: TroopTier.TIER_2,
    basePower: 38,
    cost: 130,
    upgradeCost: 220,
    maxXp: 140,
    upgradeTargetId: 'red_dune_cataphract',
    description: '追逐风暴的骑枪手。【技能：驭沙冲锋】冲锋后更易脱离纠缠。',
    equipment: ['沙纹骑枪', '轻链甲', '风沙护目'],
    attributes: troopAttr(100, 75, 120, 95, 25, 105)
  },
  red_dune_cataphract: {
    id: 'red_dune_cataphract',
    name: '赤沙具装骑',
    tier: TroopTier.TIER_3,
    basePower: 88,
    cost: 360,
    upgradeCost: 580,
    maxXp: 340,
    upgradeTargetId: 'imperial_bixi_heavy_cavalry',
    description: '赤沙驭团的具装骑兵，披甲如壁。【技能：沙暴踏阵】冲锋破甲。',
    equipment: ['重型骑枪', '红砂板甲', '具装战马'],
    attributes: troopAttr(145, 125, 125, 140, 25, 130)
  },
  imperial_rider_trainee: {
    id: 'imperial_rider_trainee',
    name: '帝国见习骑射手',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 35,
    upgradeCost: 70,
    maxXp: 40,
    upgradeTargetId: 'imperial_horse_archer',
    description: '掌握骑射节奏的新人。【技能：骑射启蒙】移动中命中率提升。',
    equipment: ['短骑弓', '轻马鞍', '皮甲'],
    attributes: troopAttr(40, 30, 65, 40, 110, 45)
  },
  imperial_horse_archer: {
    id: 'imperial_horse_archer',
    name: '帝国骑射手',
    tier: TroopTier.TIER_2,
    basePower: 32,
    cost: 115,
    upgradeCost: 190,
    maxXp: 120,
    upgradeTargetId: 'imperial_steppe_veteran',
    description: '帝国边境线上的机动猎手。【技能：回马箭】撤退时命中率提升。',
    equipment: ['复合骑弓', '骑射箭囊', '轻链甲'],
    attributes: troopAttr(75, 50, 95, 70, 130, 75)
  },
  imperial_steppe_veteran: {
    id: 'imperial_steppe_veteran',
    name: '帝国疾风老兵',
    tier: TroopTier.TIER_3,
    basePower: 70,
    cost: 280,
    upgradeCost: 450,
    maxXp: 260,
    upgradeTargetId: 'imperial_windrider_vanguard',
    description: '经验让他能在混战中射杀指挥官。【技能：流矢风暴】连续射击命中提升。',
    equipment: ['精制骑弓', '穿甲骑射箭', '边境披风'],
    attributes: troopAttr(7, 4, 7, 5, 8, 7)
  },
  imperial_windrider_vanguard: {
    id: 'imperial_windrider_vanguard',
    name: '帝国风骑先锋',
    tier: TroopTier.TIER_4,
    basePower: 130,
    cost: 820,
    upgradeCost: 0,
    maxXp: 1400,
    description: '机动战的终极象征。【技能：风暴穿刺】追击时造成额外伤害。',
    equipment: ['风骑复合弓', '猎隼披风', '轻板甲'],
    attributes: troopAttr(8, 5, 8, 6, 8, 8)
  },

  // --- RANGED TREE ---
  hunter: {
    id: 'hunter',
    name: '猎人',
    tier: TroopTier.TIER_2,
    basePower: 18,
    cost: 45,
    upgradeCost: 65,
    maxXp: 55,
    upgradeTargetId: 'archer',
    description: '熟悉森林地形。【技能：林地伪装】在森林地形回避率大幅上升。',
    equipment: ['猎弓', '小刀', '皮帽'],
    attributes: troopAttr(65, 55, 85, 60, 130, 60)
  },
  archer: {
    id: 'archer',
    name: '资深射手',
    tier: TroopTier.TIER_3,
    basePower: 30,
    cost: 110,
    upgradeCost: 160,
    maxXp: 130,
    upgradeTargetId: 'sharpshooter',
    description: '能在百步之外取敌首级。【技能：箭雨】对无盾单位造成额外伤害。',
    equipment: ['战弓', '倒刺箭', '镶钉皮甲'],
    attributes: troopAttr(6, 3, 6, 4, 7, 5)
  },
  sharpshooter: {
    id: 'sharpshooter',
    name: '神射手',
    tier: TroopTier.TIER_4,
    basePower: 70,
    cost: 300,
    upgradeCost: 550,
    maxXp: 300,
    upgradeTargetId: 'dragonslayer',
    description: '传说的弓箭大师。【技能：弱点洞察】有几率无视护甲直接造成伤害。',
    equipment: ['紫杉长弓', '穿甲箭', '精制链甲'],
    attributes: troopAttr(8, 4, 7, 5, 9, 7)
  },
  dragonslayer: {
    id: 'dragonslayer',
    name: '屠龙强弩手',
    tier: TroopTier.TIER_5,
    basePower: 140,
    cost: 900,
    upgradeCost: 0,
    maxXp: 2000,
    description: '手持重型攻城弩。【技能：巨兽杀手】对大型/巨型单位伤害翻倍。',
    equipment: ['攻城重弩', '爆裂矢', '塔盾'],
    attributes: troopAttr(9, 6, 5, 7, 10, 8)
  },

  // --- HOTPOT ARMY (FUNNY) ---
  meatball_soldier: {
    id: 'meatball_soldier',
    name: '贡丸士兵',
    tier: TroopTier.TIER_2,
    basePower: 25,
    cost: 60,
    upgradeCost: 120,
    maxXp: 80,
    upgradeTargetId: 'tofu_shield',
    description: 'Q弹的肉球战士。【技能：Q弹护甲】有50%几率弹开钝器攻击。【连携：下锅】队伍中每多一个“火锅”系单位，防御力+5%。',
    equipment: ['淀粉外壳', '猪肉核心', '竹签长矛'],
    attributes: troopAttr(4, 5, 3, 5, 1, 6)
  },
  tofu_shield: {
    id: 'tofu_shield',
    name: '冻豆腐坚盾手',
    tier: TroopTier.TIER_3,
    basePower: 45,
    cost: 150,
    upgradeCost: 300,
    maxXp: 180,
    upgradeTargetId: 'spicy_soup_mage',
    description: '吸满了汤汁的重装单位。【技能：吸汁体质】受到火焰或液体伤害时，反而会回复生命值并变大。',
    equipment: ['冻豆腐塔盾', '葱花点缀', '吸水海绵肌'],
    attributes: troopAttr(5, 7, 2, 7, 1, 6)
  },
  spicy_soup_mage: {
    id: 'spicy_soup_mage',
    name: '红油锅底法师',
    tier: TroopTier.TIER_4,
    basePower: 95,
    cost: 600,
    upgradeCost: 1000,
    maxXp: 800,
    upgradeTargetId: '',
    description: '掌握着麻辣的核心科技。【技能：泼油】对敌军造成持续燃烧伤害并降低士气。【连携：开饭】使友方所有“贡丸”和“豆腐”单位攻击附带火属性，并进入沸腾狂暴状态。',
    equipment: ['牛油法杖', '花椒项链', '无限续汤壶'],
    attributes: troopAttr(8, 4, 5, 5, 7, 7)
  },

  // --- CULTIST TREE ---
  zealot: {
    id: 'zealot',
    name: '狂热信徒',
    tier: TroopTier.TIER_2,
    basePower: 20,
    cost: 30,
    upgradeCost: 80,
    maxXp: 60,
    upgradeTargetId: 'flagellant',
    description: '不知恐惧为何物。【技能：狂乱】生命值越低攻击力越高。',
    equipment: ['火把', '生锈铁锤', '破烂长袍'],
    attributes: troopAttr(5, 3, 4, 4, 1, 7)
  },
  flagellant: {
    id: 'flagellant',
    name: '苦修者',
    tier: TroopTier.TIER_3,
    basePower: 45,
    cost: 120,
    upgradeCost: 200,
    maxXp: 150,
    upgradeTargetId: 'prophet',
    description: '承受痛苦以换取力量。【技能：牺牲】死亡时会治愈周围友军。',
    equipment: ['带刺链锤', '铁面具', '硬皮甲'],
    attributes: troopAttr(6, 4, 4, 5, 1, 7)
  },
  prophet: {
    id: 'prophet',
    name: '末日先知',
    tier: TroopTier.TIER_4,
    basePower: 75,
    cost: 400,
    upgradeCost: 800,
    maxXp: 400,
    upgradeTargetId: 'void_caller',
    description: '用晦涩的咒语扰乱战场。【技能：群体致幻】使敌军一定概率攻击友军。',
    equipment: ['仪式法杖', '致幻香炉', '华丽法袍'],
    attributes: troopAttr(7, 4, 5, 5, 7, 8)
  },
  void_caller: {
    id: 'void_caller',
    name: '虚空召唤者',
    tier: TroopTier.TIER_5,
    basePower: 180,
    cost: 1500,
    upgradeCost: 0,
    maxXp: 3000,
    description: '与深渊签订契约。【技能：深渊之门】召唤触手缠绕并吞噬敌人。',
    equipment: ['死灵之书', '虚空裂隙', '暗影护盾'],
    attributes: troopAttr(10, 5, 6, 7, 8, 9)
  },

  // --- UNDEAD TREE ---
  zombie: {
    id: 'zombie',
    name: '行尸',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 10,
    upgradeCost: 30,
    maxXp: 25,
    upgradeTargetId: 'skeleton_archer',
    description: '刚从土里爬出来的尸体。【技能：不死】被击倒后有20%概率重新站起来。',
    equipment: ['腐烂的爪子', '寿衣'],
    attributes: troopAttr(35, 35, 15, 60, 5, 255)
  },
  undead_grave_thrall: {
    id: 'undead_grave_thrall',
    name: '墓穴仆从',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 15,
    upgradeCost: 35,
    maxXp: 30,
    upgradeTargetId: 'undead_bone_javelin',
    description: '在坟土中被召唤的苦役者。【技能：腐蚀触摸】命中后小幅降低敌人护甲。',
    equipment: ['残破镰刀', '碎骨护具'],
    attributes: troopAttr(4, 3, 3, 5, 2, 5)
  },
  undead_rot_scout: {
    id: 'undead_rot_scout',
    name: '腐烂斥候',
    tier: TroopTier.TIER_1,
    basePower: 11,
    cost: 14,
    upgradeCost: 35,
    maxXp: 28,
    upgradeTargetId: 'undead_grave_arbalist',
    description: '手持旧弩的亡者。【技能：阴影潜行】短暂降低被锁定概率。',
    equipment: ['裂木短弩', '风化轻甲'],
    attributes: troopAttr(3, 3, 5, 4, 5, 5)
  },
  undead_mire_digger: {
    id: 'undead_mire_digger',
    name: '尸沼掘地者',
    tier: TroopTier.TIER_1,
    basePower: 9,
    cost: 12,
    upgradeCost: 30,
    maxXp: 24,
    upgradeTargetId: 'skeleton_archer',
    description: '从泥沼爬出的幽暗劳工。【技能：沉泥】近战命中后减速。',
    equipment: ['泥污铁铲', '湿腐裹布'],
    attributes: troopAttr(4, 4, 2, 5, 1, 5)
  },
  undead_bone_crawler: {
    id: 'undead_bone_crawler',
    name: '白骨爬行者',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 13,
    upgradeCost: 32,
    maxXp: 26,
    upgradeTargetId: 'undead_bone_slinger',
    description: '在坟丘缝隙里爬行的亡骨。【技能：缠足】命中后短暂降低敌人移速。',
    equipment: ['碎骨钩爪', '骨片甲'],
    attributes: troopAttr(4, 3, 4, 5, 2, 5)
  },
  undead_ashen_runner: {
    id: 'undead_ashen_runner',
    name: '灰烬奔行者',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 16,
    upgradeCost: 38,
    maxXp: 30,
    upgradeTargetId: 'undead_tomb_guard',
    description: '从灰烬中归来的追猎者。【技能：疾灰】短时间提升自身攻速。',
    equipment: ['焦炭短刃', '灰烬披布'],
    attributes: troopAttr(4, 3, 5, 4, 2, 6)
  },
  undead_coffin_bearer: {
    id: 'undead_coffin_bearer',
    name: '棺椁抬尸者',
    tier: TroopTier.TIER_1,
    basePower: 13,
    cost: 18,
    upgradeCost: 40,
    maxXp: 32,
    upgradeTargetId: 'undead_bone_javelin',
    description: '拖拽旧棺的沉重劳工。【技能：撞棺】冲撞目标造成短暂失衡。',
    equipment: ['棺木板盾', '枯铁短槌'],
    attributes: troopAttr(5, 4, 2, 6, 1, 5)
  },
  undead_bone_javelin: {
    id: 'undead_bone_javelin',
    name: '白骨投矛手',
    tier: TroopTier.TIER_2,
    basePower: 26,
    cost: 55,
    upgradeCost: 90,
    maxXp: 70,
    upgradeTargetId: 'skeleton_warrior',
    description: '骨矛带着寒意飞来。【技能：裂骨】对轻甲单位伤害提升。',
    equipment: ['骨矛束', '肋骨甲'],
    attributes: troopAttr(4, 3, 4, 4, 6, 4)
  },
  undead_bone_slinger: {
    id: 'undead_bone_slinger',
    name: '骨沙投石手',
    tier: TroopTier.TIER_2,
    basePower: 24,
    cost: 52,
    upgradeCost: 85,
    maxXp: 65,
    upgradeTargetId: 'skeleton_warrior',
    description: '抛射裹着骨粉的石块。【技能：骨沙】命中后降低敌人命中率。',
    equipment: ['枯骨投索', '骨砂袋'],
    attributes: troopAttr(4, 3, 4, 4, 6, 4)
  },
  undead_tomb_guard: {
    id: 'undead_tomb_guard',
    name: '墓冢卫士',
    tier: TroopTier.TIER_2,
    basePower: 30,
    cost: 70,
    upgradeCost: 110,
    maxXp: 85,
    upgradeTargetId: 'skeleton_warrior',
    description: '看守墓道的沉默守卫。【技能：镇墓】承受伤害时提高自身防御。',
    equipment: ['墓石长戟', '骨盾'],
    attributes: troopAttr(5, 5, 3, 6, 2, 5)
  },
  undead_grave_arbalist: {
    id: 'undead_grave_arbalist',
    name: '墓庭弩手',
    tier: TroopTier.TIER_2,
    basePower: 28,
    cost: 60,
    upgradeCost: 95,
    maxXp: 75,
    upgradeTargetId: 'skeleton_warrior',
    description: '缓慢上弦的亡者弩兵。【技能：冷风矢】降低目标命中率。',
    equipment: ['锈蚀重弩', '骨钉'],
    attributes: troopAttr(3, 4, 3, 5, 6, 4)
  },
  skeleton_archer: {
    id: 'skeleton_archer',
    name: '骷髅弓手',
    tier: TroopTier.TIER_2,
    basePower: 25,
    cost: 50,
    upgradeCost: 80,
    maxXp: 60,
    upgradeTargetId: 'skeleton_warrior', 
    description: '用白骨制成的弓箭。【技能：无疲劳】射击频率不会随时间下降。',
    equipment: ['白骨弓', '骨箭', '肋骨甲'],
    attributes: troopAttr(4, 2, 4, 3, 6, 4)
  },
  skeleton_warrior: {
    id: 'skeleton_warrior',
    name: '骷髅勇士',
    tier: TroopTier.TIER_3,
    basePower: 40,
    cost: 150,
    upgradeCost: 300,
    maxXp: 150,
    upgradeTargetId: 'undead_musician', // Branch change
    description: '不知疲倦的亡者。【技能：恐惧光环】降低周围低级生物的士气。',
    equipment: ['锈蚀古剑', '圆盾', '白骨'],
    attributes: troopAttr(6, 4, 3, 5, 1, 5)
  },
  undead_musician: {
    id: 'undead_musician',
    name: '亡灵唢呐手',
    tier: TroopTier.TIER_3,
    basePower: 30,
    cost: 200,
    upgradeCost: 400,
    maxXp: 200,
    upgradeTargetId: 'death_knight',
    description: '唢呐一响，黄金万两（不是）。【连携：冥府之乐】战场上所有亡灵单位攻击速度+30%，并免疫精神控制。',
    equipment: ['白骨唢呐', '丧服', '扩音喇叭'],
    attributes: troopAttr(4, 3, 4, 4, 5, 7)
  },
  specter: {
    id: 'specter',
    name: '怨灵',
    tier: TroopTier.TIER_3,
    basePower: 45,
    cost: 180,
    upgradeCost: 350,
    maxXp: 180,
    upgradeTargetId: 'death_knight',
    description: '物理攻击有50%概率落空。【技能：穿墙】无视地形阻碍。',
    equipment: ['虚无之刃', '灵体', '恐惧光环'],
    attributes: troopAttr(5, 3, 7, 4, 2, 6)
  },
  undead_hexer: {
    id: 'undead_hexer',
    name: '亡灵咒师',
    tier: TroopTier.TIER_3,
    basePower: 42,
    cost: 170,
    upgradeCost: 320,
    maxXp: 170,
    upgradeTargetId: 'vampire',
    description: '在耳边低语的咒法使敌人虚弱。【技能：衰竭】短时间降低敌方攻击。',
    equipment: ['咒骨法器', '暗影斗篷'],
    attributes: troopAttr(4, 3, 6, 4, 5, 6)
  },
  undead_plague_bearer: {
    id: 'undead_plague_bearer',
    name: '腐疫旗手',
    tier: TroopTier.TIER_3,
    basePower: 48,
    cost: 210,
    upgradeCost: 420,
    maxXp: 210,
    upgradeTargetId: 'vampire',
    description: '拖拽疫雾旗帜的亡者。【技能：疫瘴】降低周围敌军防御并缓慢流血。',
    equipment: ['疫雾旗', '腐缎甲'],
    attributes: troopAttr(5, 4, 4, 6, 3, 7)
  },
  vampire: {
    id: 'vampire',
    name: '吸血鬼子爵',
    tier: TroopTier.TIER_4,
    basePower: 85,
    cost: 500,
    upgradeCost: 800,
    maxXp: 600,
    upgradeTargetId: 'lich',
    description: '动作优雅的杀手。【技能：吸血】攻击造成的30%伤害转化为自身生命。',
    equipment: ['吸血细剑', '贵族礼服', '蝙蝠斗篷'],
    attributes: troopAttr(8, 5, 7, 6, 1, 8)
  },
  death_knight: {
    id: 'death_knight',
    name: '死亡骑士',
    tier: TroopTier.TIER_5,
    basePower: 170,
    cost: 1400,
    upgradeCost: 0,
    maxXp: 3000,
    description: '来自冥界的恐怖骑士。【技能：霜冻打击】攻击减缓敌人速度。【连携：亡者统帅】周围所有亡灵单位防御力+50%。',
    equipment: ['霜之哀伤(仿)', '幽灵战马', '黑曜石甲'],
    attributes: troopAttr(9, 8, 6, 9, 2, 10)
  },
  lich: {
    id: 'lich',
    name: '巫妖',
    tier: TroopTier.TIER_5,
    basePower: 190,
    cost: 2000,
    upgradeCost: 0,
    maxXp: 4000,
    description: '亡灵大法师。【技能：尸爆术】引爆地上的尸体造成范围伤害。【技能：复活死者】每回合复活一定数量的骷髅兵。',
    equipment: ['灵魂法杖', '命匣', '死亡之云'],
    attributes: troopAttr(9, 5, 6, 8, 8, 9)
  },

  // --- ASYLUM TROOPS (Mental Hospital Theme) ---
  // Tier 1
  mad_patient: { 
    id: 'mad_patient', 
    name: '呓语苦行僧', 
    tier: TroopTier.TIER_1, 
    basePower: 8, 
    cost: 15, 
    upgradeCost: 40, 
    maxXp: 30, 
    upgradeTargetId: 'screaming_drummer', 
    description: '嘴里念叨着无人能懂的经文，精神状态极不稳定。他坚信痛苦是通往真理的唯一路径。【技能：精神污染】靠近他的敌人会感到莫名烦躁，命中率下降。', 
    equipment: ['生锈铁链', '破烂病号服'],
    attributes: troopAttr(35, 35, 40, 50, 5, 60)
  },
  finger_thrower: { 
    id: 'finger_thrower', 
    name: '断指投石手', 
    tier: TroopTier.TIER_1, 
    basePower: 12, 
    cost: 20, 
    upgradeCost: 45, 
    maxXp: 35, 
    upgradeTargetId: 'stitch_crossbow', 
    description: '口袋里装满了从各个病房收集来的“收藏品”。他坚信把手指扔出去能种出新的朋友。【技能：骨片飞溅】造成流血效果，让敌人感到生理不适。', 
    equipment: ['一袋指骨', '弹弓'],
    attributes: troopAttr(45, 25, 55, 40, 110, 60)
  },
  headbanger: { 
    id: 'headbanger', 
    name: '铁头撞门卒', 
    tier: TroopTier.TIER_1, 
    basePower: 15, 
    cost: 25, 
    upgradeCost: 50, 
    maxXp: 40, 
    upgradeTargetId: 'torch_man', 
    description: '为了停止脑子里的声音，他选择用物理方式重启大脑。现在的头骨硬度堪比攻城锤。【技能：头槌】有概率致晕敌人，当然他自己也晕。', 
    equipment: ['特制铁头盔', '拘束带'],
    attributes: troopAttr(55, 55, 20, 65, 5, 70)
  },
  delusional_king: {
    id: 'delusional_king',
    name: '纸冠国王',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 20,
    upgradeCost: 50,
    maxXp: 40,
    upgradeTargetId: 'hypnotist_imposter',
    description: '坚信自己是流亡的国王，虽然他的王冠是硬纸板做的。任何质疑他权威的人都会被“御林铁卫”（其实是空气）带走。【技能：虚假威严】稍微提高周围友军士气。',
    equipment: ['硬纸板王冠', '拖把权杖'],
    attributes: troopAttr(30, 30, 30, 40, 5, 120)
  },

  // Tier 2
  screaming_drummer: { 
    id: 'screaming_drummer', 
    name: '尖叫鼓手', 
    tier: TroopTier.TIER_2, 
    basePower: 10, 
    cost: 80, 
    upgradeCost: 120, 
    maxXp: 100, 
    upgradeTargetId: 'headless_arbiter', 
    description: '原本是心脏外科医生，现在他用人皮鼓演奏死亡的节拍。听众通常会因为心律不齐而倒下。【连携：噪音污染】友军攻速+50%，但因为太吵防御-20%。', 
    equipment: ['人皮战鼓', '大腿骨鼓槌'],
    attributes: troopAttr(50, 40, 80, 60, 60, 100)
  },
  torch_man: { 
    id: 'torch_man', 
    name: '自燃火炬手', 
    tier: TroopTier.TIER_2, 
    basePower: 30, 
    cost: 60, 
    upgradeCost: 100, 
    maxXp: 80, 
    upgradeTargetId: 'drug_tester', 
    description: '深信自己是盗火的普罗米修斯。为了保持体温，他不得不时刻燃烧，顺便把温暖（物理）带给敌人。【技能：人体火炬】攻击附带火属性，并且会烧到靠近的任何人。', 
    equipment: ['浸油绷带', '打火石'],
    attributes: troopAttr(90, 40, 65, 70, 30, 95)
  },
  stitch_crossbow: { 
    id: 'stitch_crossbow', 
    name: '缝合怪弩手', 
    tier: TroopTier.TIER_2, 
    basePower: 35, 
    cost: 70, 
    upgradeCost: 110, 
    maxXp: 90, 
    upgradeTargetId: 'dung_beetle_knight', 
    description: '在这个疯狂的地方，肢体是可以随意拆卸的配件。他的弩机上甚至缝着一只还在抽搐的手臂，用来自动上弦。【技能：散射】一次射出多支不准的箭矢。', 
    equipment: ['拼凑重弩', '各种材质的箭'],
    attributes: troopAttr(85, 45, 55, 75, 130, 75)
  },
  electroshock_survivor: {
    id: 'electroshock_survivor',
    name: '电疗幸存者',
    tier: TroopTier.TIER_2,
    basePower: 25,
    cost: 75,
    upgradeCost: 130,
    maxXp: 90,
    upgradeTargetId: 'tesla_walker',
    description: '治疗很成功，他现在是个行走的蓄电池。每当他思考时，周围的灯泡就会闪烁。【技能：静电释放】被攻击时反弹电击伤害。',
    equipment: ['导电拘束衣', '蓄电池背包'],
    attributes: troopAttr(70, 70, 50, 75, 40, 80)
  },
  paranoid_guard: {
    id: 'paranoid_guard',
    name: '被害妄想保安',
    tier: TroopTier.TIER_2,
    basePower: 28,
    cost: 65,
    upgradeCost: 110,
    maxXp: 85,
    upgradeTargetId: 'split_personality_swordsman',
    description: '总觉得有人要害他，所以先下手为强。对任何靠近的东西（包括飞过的苍蝇）都会疯狂攻击。【技能：过度反应】先攻值极高，反击伤害增加。',
    equipment: ['防暴盾牌', '警棍', '铝箔帽'],
    attributes: troopAttr(80, 70, 85, 75, 5, 90)
  },

  // Tier 3
  wolf_rider: { 
    id: 'wolf_rider', 
    name: '幻觉狼骑兵', 
    tier: TroopTier.TIER_3, 
    basePower: 50, 
    cost: 180, 
    upgradeCost: 350, 
    maxXp: 200, 
    upgradeTargetId: 'war_bear', 
    description: '他骑着一名倒霉的护工，但他坚信那是一匹座狼。那名护工已经放弃挣扎，配合地发出狼嚎。【技能：人马合一】移动速度极快，虽然护工很累。', 
    equipment: ['皮鞭', '口球'],
    attributes: troopAttr(110, 80, 125, 100, 15, 100)
  },
  headless_arbiter: { 
    id: 'headless_arbiter', 
    name: '无头裁决者', 
    tier: TroopTier.TIER_3, 
    basePower: 60, 
    cost: 200, 
    upgradeCost: 400, 
    maxXp: 250, 
    upgradeTargetId: 'cthulhu_shadow', 
    description: '既然没有头，就不会有精神病了。逻辑闭环。虽然看不见，但他能闻到罪恶（和恐惧）的味道。【技能：盲目处决】对低血量敌人造成斩杀效果。', 
    equipment: ['断头台侧刃', '黑色长袍'],
    attributes: troopAttr(7, 5, 4, 6, 1, 7)
  },
  drug_tester: { 
    id: 'drug_tester', 
    name: '药剂试吃员', 
    tier: TroopTier.TIER_3, 
    basePower: 55, 
    cost: 180, 
    upgradeCost: 350, 
    maxXp: 220, 
    upgradeTargetId: 'multi_armed_reaver', 
    description: '吃过的药比你吃过的饭还多。身体里流淌着彩虹色的液体，呼吸都是甜腻的化学味。【技能：随机副作用】攻击可能造成毒、麻痹或狂暴等随机效果。', 
    equipment: ['巨大针筒', '防毒面具'],
    attributes: troopAttr(6, 4, 4, 5, 2, 6)
  },
  dung_beetle_knight: { 
    id: 'dung_beetle_knight', 
    name: '甲虫骑士', 
    tier: TroopTier.TIER_3, 
    basePower: 50, 
    cost: 220, 
    upgradeCost: 400, 
    maxXp: 280, 
    upgradeTargetId: 'sleepwalking_fencer', 
    description: '穿着甲虫外壳做成的盔甲，推着巨大的...球。他坚信那个球里包裹着宇宙的真理。【技能：野蛮冲撞】击退敌人并造成眩晕。', 
    equipment: ['粪叉', '甲虫壳甲'],
    attributes: troopAttr(6, 5, 3, 6, 1, 6)
  },
  alchemist: { 
    id: 'alchemist', 
    name: '非法炼金术士', 
    tier: TroopTier.TIER_3, 
    basePower: 40, 
    cost: 160, 
    upgradeCost: 280, 
    maxXp: 180, 
    upgradeTargetId: 'plague_doctor', 
    description: '原本是化学老师，后来疯了。他发现把清洁剂和漂白水混合能产生美妙的气体。【技能：酸蚀炸弹】投掷酸液瓶，削减敌方护甲。', 
    equipment: ['酸液瓶', '防护眼镜'],
    attributes: troopAttr(6, 3, 4, 4, 6, 5)
  },
  hypnotist_imposter: {
    id: 'hypnotist_imposter',
    name: '冒牌催眠师',
    tier: TroopTier.TIER_3,
    basePower: 45,
    cost: 170,
    upgradeCost: 300,
    maxXp: 200,
    upgradeTargetId: 'nightmare_weaver',
    description: '拿着怀表晃来晃去，虽然没催眠成功，但把人晃晕了。他自己经常看着看着就睡着了。【技能：晕眩怀表】一定概率使敌人停止行动一回合。',
    equipment: ['怀表', '燕尾服'],
    attributes: troopAttr(5, 3, 5, 4, 4, 6)
  },
  split_personality_swordsman: {
    id: 'split_personality_swordsman',
    name: '分裂剑客',
    tier: TroopTier.TIER_3,
    basePower: 58,
    cost: 190,
    upgradeCost: 360,
    maxXp: 230,
    upgradeTargetId: 'sleepwalking_fencer',
    description: '左手是温文尔雅的绅士，右手是嗜血的狂徒。两个人格虽然经常吵架，但砍人的时候配合得天衣无缝。【技能：双重打击】有几率进行两次攻击。',
    equipment: ['红蓝双剑', '半黑半白面具'],
    attributes: troopAttr(7, 4, 6, 5, 1, 6)
  },

  // Tier 4
  war_bear: { 
    id: 'war_bear', 
    name: '装甲战熊（玩偶）', 
    tier: TroopTier.TIER_4, 
    basePower: 100, 
    cost: 500, 
    upgradeCost: 900, 
    maxXp: 500, 
    upgradeTargetId: 'behemoth', 
    description: '一个巨大的泰迪熊玩偶，里面塞满了铁块和炸药。不要被它可爱的外表欺骗，它没有灵魂，只有杀戮指令。【技能：死亡拥抱】定身敌人并造成持续伤害。', 
    equipment: ['补丁', '棉花', '铁板'],
    attributes: troopAttr(8, 7, 3, 8, 1, 7)
  },
  multi_armed_reaver: { 
    id: 'multi_armed_reaver', 
    name: '多臂掠夺者', 
    tier: TroopTier.TIER_4, 
    basePower: 110, 
    cost: 500, 
    upgradeCost: 900, 
    maxXp: 600, 
    upgradeTargetId: 'doomsayer', 
    description: '通过外科手术接上了两条额外的手臂。效率提升了，但他也分不清哪只手是用来吃饭，哪只是用来杀人的。【技能：剑刃风暴】同时攻击周围所有敌人。', 
    equipment: ['四把砍刀', '缝合线'],
    attributes: troopAttr(8, 6, 6, 6, 1, 7)
  },
  cthulhu_shadow: { 
    id: 'cthulhu_shadow', 
    name: '克苏鲁之影', 
    tier: TroopTier.TIER_4, 
    basePower: 90, 
    cost: 600, 
    upgradeCost: 1000, 
    maxXp: 700, 
    upgradeTargetId: 'asylum_director', 
    description: '他看了一本不该看的书，现在他是书的一部分了。他的影子不再跟随他的动作，而是有了自己的想法。【技能：精神控制】短暂控制一个敌人为你作战。', 
    equipment: ['触手', '旧印'],
    attributes: troopAttr(7, 4, 6, 6, 7, 7)
  },
  sleepwalking_fencer: { 
    id: 'sleepwalking_fencer', 
    name: '梦游击剑手', 
    tier: TroopTier.TIER_4, 
    basePower: 130, 
    cost: 550, 
    upgradeCost: 950, 
    maxXp: 650, 
    upgradeTargetId: 'asylum_director', 
    description: '只有在睡着时才能发挥出绝世剑术。醒来时什么都不记得，只会奇怪剑上的血迹。【技能：无意识闪避】无法被反击。', 
    equipment: ['细剑', '睡衣', '睡帽'],
    attributes: troopAttr(8, 5, 8, 5, 1, 7)
  },
  plague_doctor: { 
    id: 'plague_doctor', 
    name: '鸟嘴医生', 
    tier: TroopTier.TIER_4, 
    basePower: 65, 
    cost: 380, 
    upgradeCost: 700, 
    maxXp: 350, 
    upgradeTargetId: 'biomutant', 
    description: '他的治疗方案通常包括放血、截肢和更多的放血。他认为只有死亡才能根治一切疾病。【技能：致命毒云】制造一片持续伤害的毒雾区域。', 
    equipment: ['鸟嘴面具', '手术刀具包'],
    attributes: troopAttr(6, 4, 5, 5, 6, 6)
  },
  tesla_walker: {
    id: 'tesla_walker',
    name: '磁暴步兵',
    tier: TroopTier.TIER_4,
    basePower: 95,
    cost: 550,
    upgradeCost: 950,
    maxXp: 600,
    upgradeTargetId: 'automaton',
    description: '全身上下缠满了线圈，走路带火花。他声称自己是交流电之父的私生子。【技能：连锁闪电】攻击会弹射到附近的敌人。',
    equipment: ['特斯拉线圈', '绝缘靴'],
    attributes: troopAttr(7, 6, 4, 6, 5, 6)
  },
  nightmare_weaver: {
    id: 'nightmare_weaver',
    name: '噩梦编织者',
    tier: TroopTier.TIER_4,
    basePower: 85,
    cost: 500,
    upgradeCost: 900,
    maxXp: 650,
    upgradeTargetId: 'doomsayer',
    description: '能把自己的疯狂幻觉具象化，让敌人也体验一下。在她的梦里，你是被追杀的那个。【技能：群体恐慌】大幅降低敌军士气。',
    equipment: ['捕梦网', '致幻粉尘'],
    attributes: troopAttr(6, 4, 7, 5, 7, 7)
  },
  automaton: { 
    id: 'automaton', 
    name: '暴走机兵', 
    tier: TroopTier.TIER_4, 
    basePower: 90, 
    cost: 600, 
    upgradeCost: 1100, 
    maxXp: 1000, 
    upgradeTargetId: 'ai_overlord',
    description: '原本是用来照顾病人的机器人，现在它决定“治愈”所有生命——通过消除生命体征。【技能：自爆程序】死亡时造成巨大范围伤害。', 
    equipment: ['蒸汽核', '圆锯手臂'],
    attributes: troopAttr(7, 6, 4, 7, 3, 6)
  },
  imaginary_friend_summoner: {
    id: 'imaginary_friend_summoner',
    name: '幻想召唤师',
    tier: TroopTier.TIER_4,
    basePower: 80,
    cost: 580,
    upgradeCost: 950,
    maxXp: 700,
    upgradeTargetId: 'cthulhu_shadow',
    description: '既然没人陪我玩，那我就自己造一个。虽然你看不到它，但它打人真的很疼。【技能：虚空打击】召唤隐形单位攻击敌人。',
    equipment: ['空白画板', '空气朋友'],
    attributes: troopAttr(6, 4, 6, 5, 7, 6)
  },

  // Tier 5
  behemoth: { 
    id: 'behemoth', 
    name: '暴食巨兽', 
    tier: TroopTier.TIER_5, 
    basePower: 200, 
    cost: 2000, 
    upgradeCost: 0, 
    maxXp: 5000, 
    description: '曾经是个厌食症患者，现在他什么都吃，包括坦克。他的胃是一个无底洞。【技能：吞噬】直接消灭小体型单位并回复生命。', 
    equipment: ['巨大的胃', '镣铐'],
    attributes: troopAttr(220, 200, 60, 240, 5, 180)
  },
  biomutant: { 
    id: 'biomutant', 
    name: '生化巨怪', 
    tier: TroopTier.TIER_5, 
    basePower: 160, 
    cost: 1200, 
    upgradeCost: 0, 
    maxXp: 2500, 
    description: '已经看不出人类的样子了，只是一团愤怒的肉块。无数的实验药剂在他体内产生了奇妙的化学反应。【技能：无限再生】每回合回复大量生命值。', 
    equipment: ['变异利爪', '外露的肌肉'],
    attributes: troopAttr(9, 7, 4, 10, 1, 8)
  },
  doomsayer: { 
    id: 'doomsayer', 
    name: '末日钟鸣者', 
    tier: TroopTier.TIER_5, 
    basePower: 220, 
    cost: 2500, 
    upgradeCost: 0, 
    maxXp: 5000, 
    description: '背负着巨大的铜钟，每一次敲击都是生命的倒计时。他看到了结局，并且迫不及待地想带你去那里。【技能：丧钟长鸣】全屏真实伤害，无视护甲。', 
    equipment: ['末日巨钟', '重锤'],
    attributes: troopAttr(230, 150, 80, 220, 180, 200)
  },
  asylum_director: { 
    id: 'asylum_director', 
    name: '黄衣院长', 
    tier: TroopTier.TIER_5, 
    basePower: 200, 
    cost: 2800, 
    upgradeCost: 0, 
    maxXp: 5000, 
    description: '这所疯人院的统治者。有人说他才是疯得最厉害的那个。在它的领域里，疯狂才是唯一的理性。【技能：强制入院】直接移除一个非Boss单位，将其“治愈”。', 
    equipment: ['院长印章', '黄色法衣'],
    attributes: troopAttr(210, 160, 140, 210, 150, 255)
  },
  god_complex_patient: {
    id: 'god_complex_patient',
    name: '自封的神明',
    tier: TroopTier.TIER_5,
    basePower: 250,
    cost: 3000,
    upgradeCost: 0,
    maxXp: 6000,
    description: '他坚信自己是神，而你们都是凡人。这种自信产生了扭曲现实的力场。【技能：神罚】对随机敌人造成毁灭性打击。',
    equipment: ['光环(画上去的)', '床单长袍'],
    attributes: troopAttr(245, 150, 120, 210, 150, 255)
  },
  ai_overlord: {
    id: 'ai_overlord',
    name: 'AI暴君',
    tier: TroopTier.TIER_5,
    basePower: 230,
    cost: 2600,
    upgradeCost: 0,
    maxXp: 5500,
    description: '它计算出了人类灭绝的最优解。不仅控制了疯人院的电子设备，还控制了所有人的起搏器。【技能：机械降神】控制所有敌方机械单位，或瘫痪所有敌人一回合。',
    equipment: ['超级计算机核心', '全息投影'],
    attributes: troopAttr(220, 160, 160, 200, 200, 200)
  },
  imposter_wanderer: {
    id: 'imposter_wanderer',
    name: '伪人行者',
    tier: TroopTier.TIER_2,
    basePower: 18,
    cost: 45,
    upgradeCost: 70,
    maxXp: 60,
    upgradeTargetId: 'imposter_stalker',
    description: '披着人类外壳的空壳躯体，步伐整齐却毫无情感。',
    equipment: ['无面面具', '空洞披风'],
    attributes: troopAttr(75, 60, 75, 75, 5, 80)
  },
  // --- NEW IMPOSTER TROOPS (TIER 1) ---
  void_larva: {
    id: 'void_larva',
    name: '虚空幼体',
    tier: TroopTier.TIER_1,
    basePower: 8,
    cost: 15,
    upgradeCost: 30,
    maxXp: 25,
    upgradeTargetId: 'entropy_acolyte',
    description: '刚从裂隙中爬出的未定型物质，渴望吞噬一切有形之物。',
    equipment: ['虚空触须'],
    attributes: troopAttr(35, 25, 60, 45, 5, 50)
  },
  glitch_pawn: {
    id: 'glitch_pawn',
    name: '故障步卒',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 20,
    upgradeCost: 40,
    maxXp: 30,
    upgradeTargetId: 'pixel_shifter',
    description: '存在感闪烁不定的士兵，仿佛现实世界的渲染错误。',
    equipment: ['闪烁长矛', '乱码盾'],
    attributes: troopAttr(50, 35, 55, 45, 5, 80)
  },
  static_noise_walker: {
    id: 'static_noise_walker',
    name: '白噪行者',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 25,
    upgradeCost: 50,
    maxXp: 35,
    upgradeTargetId: 'null_pointer_hound',
    description: '发出刺耳静电噪音的人形生物，靠近会让听觉失灵。',
    equipment: ['静电外壳'],
    attributes: troopAttr(55, 40, 60, 50, 10, 100)
  },
  null_fragment: {
    id: 'null_fragment',
    name: '空指针碎片',
    tier: TroopTier.TIER_1,
    basePower: 15,
    cost: 30,
    upgradeCost: 60,
    maxXp: 40,
    upgradeTargetId: 'syntax_error_scout',
    description: '一段指向虚无的代码碎片，物理攻击经常穿透它失效。',
    equipment: ['虚无匕首'],
    attributes: troopAttr(60, 30, 70, 40, 5, 100)
  },
  imposter_light_infantry: {
    id: 'imposter_light_infantry',
    name: '伪人轻步兵',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 25,
    upgradeCost: 55,
    maxXp: 35,
    upgradeTargetId: 'imposter_heavy_infantry',
    description: '轻甲内侧缠着未完成的皮肤渲染，面部被“平均脸”算法抹平成一张温和的空洞。【技能：错位推进】受到伤害时位置短暂错位。',
    equipment: ['裂缝皮甲', '钝化短刃'],
    attributes: troopAttr(55, 40, 60, 55, 5, 65)
  },
  imposter_spearman: {
    id: 'imposter_spearman',
    name: '伪人矛兵',
    tier: TroopTier.TIER_1,
    basePower: 13,
    cost: 28,
    upgradeCost: 60,
    maxXp: 38,
    upgradeTargetId: 'imposter_pikeman',
    description: '矛头像被复制了两次，贯穿轨迹像是一条重复的指令。脸部像老旧游戏里的NPC，近看会不断“重置”。【技能：重复刺击】同一目标可连刺。',
    equipment: ['复刻长矛', '裂纹木盾'],
    attributes: troopAttr(50, 45, 50, 55, 15, 60)
  },
  imposter_short_bowman: {
    id: 'imposter_short_bowman',
    name: '伪人短弓手',
    tier: TroopTier.TIER_1,
    basePower: 11,
    cost: 24,
    upgradeCost: 55,
    maxXp: 34,
    upgradeTargetId: 'imposter_longbowman',
    description: '弓弦像噪点线段不停颤抖，脸部贴图是同一张衰老脸的扁平复制。【技能：失真齐射】有概率多射一箭。',
    equipment: ['折损短弓', '噪点箭袋'],
    attributes: troopAttr(45, 30, 60, 45, 110, 55)
  },
  imposter_slinger: {
    id: 'imposter_slinger',
    name: '伪人投石兵',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 22,
    upgradeCost: 50,
    maxXp: 32,
    upgradeTargetId: 'imposter_crossbowman',
    description: '投石轨迹像被回滚的录像，石子落地时先响后碎。脸像被时间压扁的老人面膜。【技能：回放投掷】命中后造成二次震荡。',
    equipment: ['回卷投索', '破损石弹'],
    attributes: troopAttr(40, 25, 55, 40, 90, 50)
  },
  imposter_shield_conscript: {
    id: 'imposter_shield_conscript',
    name: '伪人盾役',
    tier: TroopTier.TIER_1,
    basePower: 14,
    cost: 30,
    upgradeCost: 65,
    maxXp: 40,
    upgradeTargetId: 'imposter_mace_guard',
    description: '盾面映出别人的脸，却总是慢半拍，像预渲染错误。它们的面孔同样老旧且统一。【技能：迟滞护卫】降低近战伤害。',
    equipment: ['折影木盾', '钝头短矛'],
    attributes: troopAttr(45, 55, 35, 60, 5, 60)
  },
  imposter_axeman: {
    id: 'imposter_axeman',
    name: '伪人斧兵',
    tier: TroopTier.TIER_1,
    basePower: 13,
    cost: 26,
    upgradeCost: 60,
    maxXp: 36,
    upgradeTargetId: 'imposter_swordsman',
    description: '斧刃像被拉长的像素块，挥动时会“撕裂”空气。面部像旧世代老人的平均脸，纹理滑得发冷。【技能：裂像劈砍】对盾兵伤害提升。',
    equipment: ['像素战斧', '薄铁护手'],
    attributes: troopAttr(60, 35, 50, 55, 5, 55)
  },
  imposter_javelin_thrower: {
    id: 'imposter_javelin_thrower',
    name: '伪人投矛手',
    tier: TroopTier.TIER_1,
    basePower: 12,
    cost: 25,
    upgradeCost: 58,
    maxXp: 35,
    upgradeTargetId: 'imposter_halberdier',
    description: '投矛在半空会出现重复残影，像是同时穿过多个维度。它们的脸被算法平均成毫无特征的老人面孔。【技能：残影投掷】命中率提升。',
    equipment: ['残影短矛', '裂纹护肩'],
    attributes: troopAttr(50, 35, 55, 45, 80, 55)
  },
  imposter_scout_rider: {
    id: 'imposter_scout_rider',
    name: '伪人侦骑',
    tier: TroopTier.TIER_1,
    basePower: 16,
    cost: 35,
    upgradeCost: 70,
    maxXp: 42,
    upgradeTargetId: 'imposter_raider_rider',
    description: '坐骑像被错位生成的木马，奔跑时影子反向移动。骑手脸部都是统一老面孔，像被系统批量生成。【技能：影子侦察】先手率提升。',
    equipment: ['裂缝短枪', '错位马鞍'],
    attributes: troopAttr(55, 35, 70, 55, 10, 65)
  },

  // --- TIER 2 ---
  entropy_acolyte: {
    id: 'entropy_acolyte',
    name: '熵增侍僧',
    tier: TroopTier.TIER_2,
    basePower: 25,
    cost: 60,
    upgradeCost: 100,
    maxXp: 80,
    upgradeTargetId: 'memory_leak_mage',
    description: '崇拜热寂的狂信徒，所过之处万物衰败。',
    equipment: ['衰变法杖', '灰烬长袍'],
    attributes: troopAttr(85, 50, 65, 70, 130, 90)
  },
  pixel_shifter: {
    id: 'pixel_shifter',
    name: '像素移位者',
    tier: TroopTier.TIER_2,
    basePower: 30,
    cost: 70,
    upgradeCost: 120,
    maxXp: 90,
    upgradeTargetId: 'recursion_archer',
    description: '身体由不稳定的像素块组成，难以被锁定。',
    equipment: ['像素弓', '低分辨率甲'],
    attributes: troopAttr(75, 50, 105, 60, 5, 90)
  },
  null_pointer_hound: {
    id: 'null_pointer_hound',
    name: '空指猎犬',
    tier: TroopTier.TIER_2,
    basePower: 35,
    cost: 80,
    upgradeCost: 140,
    maxXp: 100,
    upgradeTargetId: 'deadlock_sentinel',
    description: '追踪错误的逻辑猎犬，一旦咬住就不会松口，直到系统崩溃。',
    equipment: ['逻辑利齿', '错误追踪器'],
    attributes: troopAttr(95, 60, 90, 80, 5, 100)
  },
  syntax_error_scout: {
    id: 'syntax_error_scout',
    name: '语法错误斥候',
    tier: TroopTier.TIER_2,
    basePower: 28,
    cost: 65,
    upgradeCost: 110,
    maxXp: 85,
    upgradeTargetId: 'buffer_overflow_brute',
    description: '行动逻辑完全违背常理，让人无法预测下一步动作。',
    equipment: ['违规短刀', '报错轻甲'],
    attributes: troopAttr(85, 55, 100, 70, 5, 100)
  },
  imposter_heavy_infantry: {
    id: 'imposter_heavy_infantry',
    name: '伪人重装步兵',
    tier: TroopTier.TIER_2,
    basePower: 30,
    cost: 90,
    upgradeCost: 150,
    maxXp: 95,
    upgradeTargetId: 'imposter_pike_guard',
    description: '铠甲像是从多个时代拼接而成，关节处不断渗出“缺口”。面部是一张平滑且年迈的平均脸。【技能：沉默推进】近战冲突时稳定阵线。',
    equipment: ['拼接重甲', '重钝短剑'],
    attributes: troopAttr(90, 95, 55, 95, 5, 85)
  },
  imposter_pikeman: {
    id: 'imposter_pikeman',
    name: '伪人长枪兵',
    tier: TroopTier.TIER_2,
    basePower: 31,
    cost: 92,
    upgradeCost: 155,
    maxXp: 98,
    upgradeTargetId: 'imposter_pike_guard',
    description: '长枪像是无限延伸的引用，直指你的影子。脸部每一次眨眼都像在重启。【技能：刺猬阵】对骑兵伤害提升。',
    equipment: ['延伸长枪', '紧固皮甲'],
    attributes: troopAttr(85, 80, 60, 80, 25, 80)
  },
  imposter_swordsman: {
    id: 'imposter_swordsman',
    name: '伪人剑士',
    tier: TroopTier.TIER_2,
    basePower: 33,
    cost: 100,
    upgradeCost: 165,
    maxXp: 105,
    upgradeTargetId: 'imposter_reaper_blade',
    description: '剑身像被复制过多次的镜面，挥动时会露出另一张老人的脸。姿态熟练却毫无生命。【技能：镜像斩】有概率追加斩击。',
    equipment: ['镜面长剑', '隐裂护臂'],
    attributes: troopAttr(95, 85, 65, 85, 5, 80)
  },
  imposter_longbowman: {
    id: 'imposter_longbowman',
    name: '伪人长弓手',
    tier: TroopTier.TIER_2,
    basePower: 30,
    cost: 95,
    upgradeCost: 160,
    maxXp: 100,
    upgradeTargetId: 'imposter_horse_archer',
    description: '长弓拉开时会出现第二条弓臂，像是维度错叠。脸部纹理被平均成干裂的老脸。【技能：扭曲贯穿】远程伤害提升。',
    equipment: ['错叠长弓', '分层箭袋'],
    attributes: troopAttr(85, 55, 90, 70, 170, 80)
  },
  imposter_crossbowman: {
    id: 'imposter_crossbowman',
    name: '伪人弩兵',
    tier: TroopTier.TIER_2,
    basePower: 34,
    cost: 110,
    upgradeCost: 170,
    maxXp: 110,
    upgradeTargetId: 'imposter_horse_archer',
    description: '弩机每次上弦都会多出一条影子弦，像是同一指令重复执行。面部是统一的老者平均脸。【技能：断行弩矢】对重甲更有效。',
    equipment: ['偏移重弩', '穿模弩栓'],
    attributes: troopAttr(100, 65, 70, 75, 160, 75)
  },
  imposter_halberdier: {
    id: 'imposter_halberdier',
    name: '伪人钩镰兵',
    tier: TroopTier.TIER_2,
    basePower: 32,
    cost: 98,
    upgradeCost: 165,
    maxXp: 105,
    upgradeTargetId: 'imposter_pike_guard',
    description: '钩镰会抓住“没有实体”的东西，像是强行拖拽你的影子。脸部稳定得异常，像被冻结的老照片。【技能：裂缝拖拽】降低敌人机动。',
    equipment: ['裂缝钩镰', '铁扣护甲'],
    attributes: troopAttr(90, 75, 60, 85, 20, 80)
  },
  imposter_mace_guard: {
    id: 'imposter_mace_guard',
    name: '伪人钉锤守卫',
    tier: TroopTier.TIER_2,
    basePower: 36,
    cost: 120,
    upgradeCost: 190,
    maxXp: 120,
    upgradeTargetId: 'imposter_heavy_knight',
    description: '钉锤像是错误堆栈的实体化，每一击都在“重写”骨头。面部是同一张衰老的平均脸。【技能：重写重击】对盾兵伤害提升。',
    equipment: ['堆栈钉锤', '裂纹重盾'],
    attributes: troopAttr(100, 100, 45, 110, 5, 90)
  },
  imposter_raider_rider: {
    id: 'imposter_raider_rider',
    name: '伪人劫骑',
    tier: TroopTier.TIER_2,
    basePower: 35,
    cost: 115,
    upgradeCost: 185,
    maxXp: 115,
    upgradeTargetId: 'imposter_heavy_knight',
    description: '马蹄踏下去会先出现一圈延迟残影，像慢半拍的录像。骑手脸部同样被平均到失去个体性。【技能：错帧冲刺】冲锋命中率提升。',
    equipment: ['错帧长枪', '残影轻甲'],
    attributes: troopAttr(90, 60, 95, 80, 15, 85)
  },

  // --- TIER 3 ---
  imposter_stalker: {
    id: 'imposter_stalker',
    name: '伪人潜行者',
    tier: TroopTier.TIER_3,
    basePower: 42,
    cost: 110,
    upgradeCost: 160,
    maxXp: 160,
    upgradeTargetId: 'imposter_mirrorblade',
    description: '擅长在阴影中寻找破绽，攻击时只留下刺耳的尖笑。',
    equipment: ['折光短刃', '幽影甲'],
    attributes: troopAttr(120, 75, 135, 90, 5, 120)
  },
  memory_leak_mage: {
    id: 'memory_leak_mage',
    name: '内存泄漏法师',
    tier: TroopTier.TIER_3,
    basePower: 55,
    cost: 150,
    upgradeCost: 250,
    maxXp: 200,
    upgradeTargetId: 'blue_screen_golem',
    description: '不断吞噬周围的魔力与生命力，直到世界卡死。【技能：资源耗尽】降低敌军体力恢复。',
    equipment: ['溢出法球', '漏洞法袍'],
    attributes: troopAttr(135, 70, 75, 90, 160, 120)
  },
  recursion_archer: {
    id: 'recursion_archer',
    name: '递归弓手',
    tier: TroopTier.TIER_3,
    basePower: 60,
    cost: 160,
    upgradeCost: 280,
    maxXp: 220,
    upgradeTargetId: 'segmentation_fault_dragon',
    description: '射出的箭矢会分裂成更多箭矢，无穷无尽。【技能：无限递归】箭矢命中后分裂。',
    equipment: ['分形长弓', '递归箭囊'],
    attributes: troopAttr(125, 70, 100, 90, 180, 120)
  },
  deadlock_sentinel: {
    id: 'deadlock_sentinel',
    name: '死锁卫士',
    tier: TroopTier.TIER_3,
    basePower: 70,
    cost: 180,
    upgradeCost: 300,
    maxXp: 250,
    upgradeTargetId: 'kernel_panic_knight',
    description: '两个卫士互相争夺同一块盾牌，导致谁也无法移动，但也坚不可摧。【技能：资源互斥】极高的物理防御。',
    equipment: ['互斥大盾', '等待长矛'],
    attributes: troopAttr(100, 145, 30, 140, 5, 140)
  },
  buffer_overflow_brute: {
    id: 'buffer_overflow_brute',
    name: '溢出暴徒',
    tier: TroopTier.TIER_3,
    basePower: 80,
    cost: 200,
    upgradeCost: 350,
    maxXp: 280,
    upgradeTargetId: 'system_crash_titan',
    description: '力量超出了身体的承载上限，每一拳都伴随着数据溢出的爆炸。',
    equipment: ['溢出重锤', '超限铠甲'],
    attributes: troopAttr(150, 100, 60, 125, 5, 140)
  },
  imposter_heavy_knight: {
    id: 'imposter_heavy_knight',
    name: '伪人重装骑士',
    tier: TroopTier.TIER_3,
    basePower: 80,
    cost: 240,
    upgradeCost: 380,
    maxXp: 260,
    upgradeTargetId: 'kernel_panic_knight',
    description: '盔甲像被重复打印后硬塞进同一层现实，金属彼此穿模。面部是统一的老者平均脸，完全不眨眼。【技能：重叠冲锋】冲锋伤害提升。',
    equipment: ['重叠板甲', '断层战枪'],
    attributes: troopAttr(140, 130, 90, 130, 15, 120)
  },
  imposter_horse_archer: {
    id: 'imposter_horse_archer',
    name: '伪人弓骑兵',
    tier: TroopTier.TIER_3,
    basePower: 68,
    cost: 210,
    upgradeCost: 320,
    maxXp: 230,
    upgradeTargetId: 'segmentation_fault_dragon',
    description: '箭矢在空中会出现第二条轨迹，像从另一个维度射出。脸部纹理被“平均”到像褪色旧照片。【技能：交错射击】高机动射击不减伤。',
    equipment: ['交错长弓', '裂帘马具'],
    attributes: troopAttr(120, 75, 130, 95, 170, 110)
  },
  imposter_pike_guard: {
    id: 'imposter_pike_guard',
    name: '伪人长枪卫队',
    tier: TroopTier.TIER_3,
    basePower: 72,
    cost: 220,
    upgradeCost: 340,
    maxXp: 240,
    upgradeTargetId: 'imposter_mirrorblade',
    description: '长枪末端像被无尽复制，挥动时发出低频啸叫。面部被固定成同一张年迈的平均脸。【技能：层叠枪林】对骑兵极其致命。',
    equipment: ['层叠长枪', '错位重盾'],
    attributes: troopAttr(115, 120, 70, 120, 25, 115)
  },
  imposter_reaper_blade: {
    id: 'imposter_reaper_blade',
    name: '伪人收割剑士',
    tier: TroopTier.TIER_3,
    basePower: 70,
    cost: 215,
    upgradeCost: 330,
    maxXp: 235,
    upgradeTargetId: 'imposter_mirrorblade',
    description: '剑刃像被切分成数段又强行拼回，挥砍时会出现迟滞回声。面孔是完全一致的老者平均脸。【技能：回声斩】命中后造成追击伤害。',
    equipment: ['回声长剑', '裂隙披肩'],
    attributes: troopAttr(135, 90, 110, 105, 5, 110)
  },

  // --- TIER 4 ---
  imposter_mirrorblade: {
    id: 'imposter_mirrorblade',
    name: '伪人镜刃',
    tier: TroopTier.TIER_4,
    basePower: 95,
    cost: 320,
    upgradeCost: 0,
    maxXp: 600,
    description: '能够模仿敌人的动作与节奏，剑刃像镜子一样折射杀意。',
    equipment: ['镜刃', '裂隙披风'],
    attributes: troopAttr(175, 120, 180, 140, 5, 160)
  },
  blue_screen_golem: {
    id: 'blue_screen_golem',
    name: '蓝屏魔像',
    tier: TroopTier.TIER_4,
    basePower: 110,
    cost: 500,
    upgradeCost: 0,
    maxXp: 800,
    description: '通体散发着令人绝望的深蓝色光芒，看到它的人都会感到大脑宕机。【技能：强制重启】击晕周围敌人。',
    equipment: ['0x000000ED重拳', '致命错误核心'],
    attributes: troopAttr(175, 175, 50, 200, 5, 160)
  },
  kernel_panic_knight: {
    id: 'kernel_panic_knight',
    name: '内核恐慌骑士',
    tier: TroopTier.TIER_4,
    basePower: 120,
    cost: 600,
    upgradeCost: 0,
    maxXp: 900,
    description: '骑着崩坏的代码战马，所到之处规则崩塌。【技能：底层崩溃】无视护甲。',
    equipment: ['恐慌长枪', '崩溃战马'],
    attributes: troopAttr(195, 150, 150, 160, 15, 180)
  },
  segmentation_fault_dragon: {
    id: 'segmentation_fault_dragon',
    name: '段错误骨龙',
    tier: TroopTier.TIER_4,
    basePower: 130,
    cost: 700,
    upgradeCost: 0,
    maxXp: 1000,
    description: '访问了不该访问的内存区域而诞生的怪物。吐息能抹除敌人的存在。【技能：非法访问】对单体造成巨额真实伤害。',
    equipment: ['越界龙息', '野指针利爪'],
    attributes: troopAttr(200, 130, 140, 180, 120, 200)
  },
  not_found_assassin: {
    id: 'not_found_assassin',
    name: '404刺客',
    tier: TroopTier.TIER_4,
    basePower: 100,
    cost: 550,
    upgradeCost: 0,
    maxXp: 850,
    description: '你以为你在攻击他，但那个位置什么都没有。【技能：资源未找到】极高的闪避率。',
    equipment: ['丢失的匕首', '无法访问的披风'],
    attributes: troopAttr(185, 70, 200, 100, 10, 200)
  },

  // --- TIER 5 (BOSSES) ---
  legacy_code_abomination: {
    id: 'legacy_code_abomination',
    name: '祖传代码憎恶',
    tier: TroopTier.TIER_5,
    basePower: 200,
    cost: 2000,
    upgradeCost: 0,
    maxXp: 4000,
    description: '没有人知道它是怎么运行的，也没人敢动它。它由无数补丁和临时方案堆砌而成，散发着古老而恐怖的气息。【技能：牵一发而动全身】受到攻击时反弹伤害给所有敌人。',
    equipment: ['陈旧依赖库', '意大利面条触手'],
    attributes: troopAttr(210, 230, 50, 255, 5, 255)
  },
  system_crash_titan: {
    id: 'system_crash_titan',
    name: '系统崩溃泰坦',
    tier: TroopTier.TIER_5,
    basePower: 250,
    cost: 2500,
    upgradeCost: 0,
    maxXp: 5000,
    description: '它的降临意味着一切的终结。重启也无法挽救。【技能：全服回档】复活已死亡的友军伪人单位。',
    equipment: ['停机维护巨斧', '断连重甲'],
    attributes: troopAttr(240, 220, 60, 250, 5, 230)
  },
  infinite_loop_devourer: {
    id: 'infinite_loop_devourer',
    name: '死循环吞噬者',
    tier: TroopTier.TIER_5,
    basePower: 220,
    cost: 2200,
    upgradeCost: 0,
    maxXp: 4500,
    description: '它会让你在同一段时间里无限重复死亡的过程。【技能：堆栈溢出】造成范围持续伤害，且越来越高。',
    equipment: ['无尽循环之口', '卡死时钟'],
    attributes: troopAttr(210, 180, 100, 220, 120, 230)
  },

  bug_null_pointer_scout: {
    id: 'bug_null_pointer_scout',
    name: '空指针侦察者',
    tier: TroopTier.TIER_1,
    basePower: 8,
    cost: 20,
    upgradeCost: 45,
    maxXp: 140,
    upgradeTargetId: 'bug_seg_fault_guard',
    description: '走位像指针一样飘忽，命中时总让你感觉“指向了不存在的目标”。【技能：空域掠影】提升闪避与突袭概率。',
    equipment: ['断链匕首', '游标披风'],
    attributes: troopAttr(22, 16, 34, 22, 5, 38)
  },
  bug_seg_fault_guard: {
    id: 'bug_seg_fault_guard',
    name: '段错误守卫',
    tier: TroopTier.TIER_2,
    basePower: 19,
    cost: 65,
    upgradeCost: 110,
    maxXp: 320,
    upgradeTargetId: 'bug_memory_leak_reaver',
    description: '它的护甲像内存段，越界一步就会触发致命反击。【技能：段保护】提升格挡与反击率。',
    equipment: ['分段战斧', '地址护盾'],
    attributes: troopAttr(42, 40, 36, 50, 5, 55)
  },
  bug_memory_leak_reaver: {
    id: 'bug_memory_leak_reaver',
    name: '内存泄漏劫掠者',
    tier: TroopTier.TIER_3,
    basePower: 38,
    cost: 160,
    upgradeCost: 200,
    maxXp: 820,
    upgradeTargetId: 'bug_heap_corruptor',
    description: '作战会持续消耗敌方资源，像漏掉的内存永远回不来。【技能：资源腐蚀】长期作战优势越滚越大。',
    equipment: ['泄漏长刃', '资源抽取囊'],
    attributes: troopAttr(70, 58, 52, 80, 20, 70)
  },
  bug_heap_corruptor: {
    id: 'bug_heap_corruptor',
    name: '堆破坏者',
    tier: TroopTier.TIER_4,
    basePower: 88,
    cost: 520,
    upgradeCost: 720,
    maxXp: 1600,
    upgradeTargetId: 'bug_kernel_panic_titan',
    description: '它能搅乱敌阵后勤，让补给像堆一样崩塌。【技能：堆崩塌】压制敌方恢复与士气。',
    equipment: ['堆裂大锤', '崩坏护胄'],
    attributes: troopAttr(120, 120, 70, 140, 20, 95)
  },
  bug_kernel_panic_titan: {
    id: 'bug_kernel_panic_titan',
    name: '内核恐慌泰坦',
    tier: TroopTier.TIER_5,
    basePower: 190,
    cost: 1500,
    upgradeCost: 0,
    maxXp: 2600,
    description: '它的咆哮会让敌军“系统失稳”，短暂失去指挥。【技能：内核恐慌】范围压制与控制。',
    equipment: ['黑核巨斧', '恐慌装甲'],
    attributes: troopAttr(200, 190, 80, 210, 25, 140)
  },

  bug_off_by_one_runner: {
    id: 'bug_off_by_one_runner',
    name: '偏一疾行者',
    tier: TroopTier.TIER_1,
    basePower: 9,
    cost: 22,
    upgradeCost: 45,
    maxXp: 140,
    upgradeTargetId: 'bug_boundary_skirmisher',
    description: '总能多走一步，躲过你的判定范围。【技能：越界一步】提升机动与先手。',
    equipment: ['校准短枪', '偏位护腿'],
    attributes: troopAttr(20, 14, 40, 20, 5, 40)
  },
  bug_boundary_skirmisher: {
    id: 'bug_boundary_skirmisher',
    name: '边界游击兵',
    tier: TroopTier.TIER_2,
    basePower: 20,
    cost: 70,
    upgradeCost: 115,
    maxXp: 320,
    upgradeTargetId: 'bug_index_outlaw',
    description: '它不断试探边界，寻找最薄弱的那条线。【技能：边界切割】对侧翼更具威胁。',
    equipment: ['界限双刃', '折线护臂'],
    attributes: troopAttr(46, 34, 50, 48, 10, 55)
  },
  bug_index_outlaw: {
    id: 'bug_index_outlaw',
    name: '索引亡命徒',
    tier: TroopTier.TIER_3,
    basePower: 40,
    cost: 170,
    upgradeCost: 210,
    maxXp: 840,
    upgradeTargetId: 'bug_array_overrun_ravager',
    description: '它会切掉敌军阵线的“索引”，让敌军队形错位。【技能：索引错乱】削弱阵型协调。',
    equipment: ['索引链枪', '错位胸甲'],
    attributes: troopAttr(78, 55, 66, 90, 25, 70)
  },
  bug_array_overrun_ravager: {
    id: 'bug_array_overrun_ravager',
    name: '数组溢出掠夺者',
    tier: TroopTier.TIER_4,
    basePower: 92,
    cost: 540,
    upgradeCost: 740,
    maxXp: 1650,
    upgradeTargetId: 'bug_buffer_overrun_colossus',
    description: '冲锋时会把敌阵挤出原本的格子。【技能：溢出冲撞】擅长打乱队列。',
    equipment: ['溢出冲锤', '边界冲撞甲'],
    attributes: troopAttr(130, 110, 85, 150, 10, 100)
  },
  bug_buffer_overrun_colossus: {
    id: 'bug_buffer_overrun_colossus',
    name: '缓冲溢出巨像',
    tier: TroopTier.TIER_5,
    basePower: 200,
    cost: 1600,
    upgradeCost: 0,
    maxXp: 2600,
    description: '它的冲击会把防线直接推入混乱。【技能：缓冲坍塌】对守军造成巨大破坏。',
    equipment: ['溢出攻城槌', '巨像壳甲'],
    attributes: troopAttr(210, 200, 70, 230, 10, 150)
  },

  bug_race_condition_scout: {
    id: 'bug_race_condition_scout',
    name: '竞态斥候',
    tier: TroopTier.TIER_1,
    basePower: 9,
    cost: 22,
    upgradeCost: 45,
    maxXp: 140,
    upgradeTargetId: 'bug_deadlock_enforcer',
    description: '先手永远先到一步，让敌军节奏混乱。【技能：竞速突袭】提升先攻与扰乱。',
    equipment: ['竞速短刃', '时序腰带'],
    attributes: troopAttr(21, 15, 42, 22, 5, 38)
  },
  bug_deadlock_enforcer: {
    id: 'bug_deadlock_enforcer',
    name: '死锁执法者',
    tier: TroopTier.TIER_2,
    basePower: 21,
    cost: 72,
    upgradeCost: 120,
    maxXp: 330,
    upgradeTargetId: 'bug_livelock_duelist',
    description: '缠住敌军后就像锁住一样无法脱身。【技能：死锁缠斗】降低敌军机动。',
    equipment: ['锁链钩刃', '封锁护甲'],
    attributes: troopAttr(45, 42, 35, 55, 5, 58)
  },
  bug_livelock_duelist: {
    id: 'bug_livelock_duelist',
    name: '活锁决斗者',
    tier: TroopTier.TIER_3,
    basePower: 41,
    cost: 175,
    upgradeCost: 215,
    maxXp: 850,
    upgradeTargetId: 'bug_threadstorm_savant',
    description: '看似在躲闪，实则逼迫对手在原地耗尽精力。【技能：活锁缠身】持续消耗敌方士气。',
    equipment: ['循环双刺', '并发护腕'],
    attributes: troopAttr(76, 60, 68, 92, 5, 75)
  },
  bug_threadstorm_savant: {
    id: 'bug_threadstorm_savant',
    name: '线程风暴贤者',
    tier: TroopTier.TIER_4,
    basePower: 96,
    cost: 560,
    upgradeCost: 760,
    maxXp: 1700,
    upgradeTargetId: 'bug_concurrency_overlord',
    description: '同时操控多条战线，像风暴一样席卷。【技能：线程风暴】大范围扰乱。',
    equipment: ['多线程长刃', '风暴裹袍'],
    attributes: troopAttr(130, 115, 95, 150, 35, 105)
  },
  bug_concurrency_overlord: {
    id: 'bug_concurrency_overlord',
    name: '并发霸主',
    tier: TroopTier.TIER_5,
    basePower: 205,
    cost: 1650,
    upgradeCost: 0,
    maxXp: 2700,
    description: '它像调度器一样操纵战场节奏。【技能：并发统治】压制敌军指挥效率。',
    equipment: ['并发长戟', '调度王座'],
    attributes: troopAttr(215, 195, 90, 230, 40, 150)
  },

  bug_float_drift_apprentice: {
    id: 'bug_float_drift_apprentice',
    name: '浮点漂移学徒',
    tier: TroopTier.TIER_1,
    basePower: 8,
    cost: 20,
    upgradeCost: 45,
    maxXp: 140,
    upgradeTargetId: 'bug_precision_sniper',
    description: '它的箭像小数点一样难以捕捉。【技能：漂移射击】提升远程闪避。',
    equipment: ['漂移轻弓', '浮点指环'],
    attributes: troopAttr(18, 12, 38, 20, 55, 36)
  },
  bug_precision_sniper: {
    id: 'bug_precision_sniper',
    name: '精度狙击手',
    tier: TroopTier.TIER_2,
    basePower: 20,
    cost: 70,
    upgradeCost: 115,
    maxXp: 330,
    upgradeTargetId: 'bug_nan_oracle',
    description: '它知道哪一位小数会决定生死。【技能：精度狙击】提升命中与爆伤。',
    equipment: ['精度长弓', '校准护具'],
    attributes: troopAttr(40, 28, 50, 45, 85, 55)
  },
  bug_nan_oracle: {
    id: 'bug_nan_oracle',
    name: 'NaN 先知',
    tier: TroopTier.TIER_3,
    basePower: 42,
    cost: 180,
    upgradeCost: 220,
    maxXp: 860,
    upgradeTargetId: 'bug_underflow_prophet',
    description: '它的法术会让敌军判断失效。【技能：不可判定】削弱敌方命中。',
    equipment: ['NaN 法杖', '未定义披肩'],
    attributes: troopAttr(60, 55, 60, 85, 90, 80)
  },
  bug_underflow_prophet: {
    id: 'bug_underflow_prophet',
    name: '下溢预言者',
    tier: TroopTier.TIER_4,
    basePower: 94,
    cost: 550,
    upgradeCost: 740,
    maxXp: 1680,
    upgradeTargetId: 'bug_overflow_cataclysm',
    description: '它让敌军力量逐渐衰减到“看不见”。【技能：下溢枯竭】压制输出。',
    equipment: ['下溢权杖', '衰减法袍'],
    attributes: troopAttr(100, 120, 75, 150, 100, 120)
  },
  bug_overflow_cataclysm: {
    id: 'bug_overflow_cataclysm',
    name: '上溢灾变者',
    tier: TroopTier.TIER_5,
    basePower: 210,
    cost: 1700,
    upgradeCost: 0,
    maxXp: 2700,
    description: '它的能量溢出如天灾。【技能：溢出震荡】造成范围重击。',
    equipment: ['溢出法杖', '灾变法袍'],
    attributes: troopAttr(190, 210, 70, 240, 110, 160)
  },

  bug_syntax_error_mender: {
    id: 'bug_syntax_error_mender',
    name: '语法错修匠',
    tier: TroopTier.TIER_1,
    basePower: 8,
    cost: 20,
    upgradeCost: 45,
    maxXp: 140,
    upgradeTargetId: 'bug_parser_cutlass',
    description: '错误的语法让它挥砍时总带着奇怪的节奏。【技能：错位打击】增加穿插命中。',
    equipment: ['断句短剑', '纠错皮甲'],
    attributes: troopAttr(20, 16, 34, 24, 10, 38)
  },
  bug_parser_cutlass: {
    id: 'bug_parser_cutlass',
    name: '解析弯刀客',
    tier: TroopTier.TIER_2,
    basePower: 19,
    cost: 65,
    upgradeCost: 110,
    maxXp: 320,
    upgradeTargetId: 'bug_compiler_hexer',
    description: '它能在一眼里分解敌阵结构。【技能：语法拆解】提升破甲与命中。',
    equipment: ['解析弯刀', '语法护臂'],
    attributes: troopAttr(44, 34, 42, 50, 15, 58)
  },
  bug_compiler_hexer: {
    id: 'bug_compiler_hexer',
    name: '编译诅咒师',
    tier: TroopTier.TIER_3,
    basePower: 41,
    cost: 175,
    upgradeCost: 215,
    maxXp: 850,
    upgradeTargetId: 'bug_build_breaker',
    description: '它的咒文让敌军阵型“无法通过”。【技能：编译失败】降低敌军输出稳定性。',
    equipment: ['编译符杖', '构建残卷'],
    attributes: troopAttr(65, 62, 60, 90, 70, 85)
  },
  bug_build_breaker: {
    id: 'bug_build_breaker',
    name: '构建破坏者',
    tier: TroopTier.TIER_4,
    basePower: 92,
    cost: 540,
    upgradeCost: 740,
    maxXp: 1650,
    upgradeTargetId: 'bug_ci_apocalypse',
    description: '它能让补给线像构建管线一样崩断。【技能：流水线崩塌】削弱敌军士气。',
    equipment: ['构建巨斧', '断链护甲'],
    attributes: troopAttr(115, 130, 70, 150, 20, 120)
  },
  bug_ci_apocalypse: {
    id: 'bug_ci_apocalypse',
    name: 'CI 末日使',
    tier: TroopTier.TIER_5,
    basePower: 195,
    cost: 1550,
    upgradeCost: 0,
    maxXp: 2600,
    description: '它能让一切更新停滞在失败的警报里。【技能：持续失败】持续压制敌军。',
    equipment: ['末日刻印锤', '警报护衣'],
    attributes: troopAttr(210, 190, 75, 220, 35, 150)
  },

  bug_infinite_loop_monk: {
    id: 'bug_infinite_loop_monk',
    name: '循环苦行僧',
    tier: TroopTier.TIER_1,
    basePower: 9,
    cost: 22,
    upgradeCost: 45,
    maxXp: 140,
    upgradeTargetId: 'bug_stack_repeater',
    description: '它能不断重复一招，像永不停止的函数调用。【技能：循环打击】提升连击率。',
    equipment: ['循环拳套', '递归布衣'],
    attributes: troopAttr(22, 18, 36, 24, 5, 40)
  },
  bug_stack_repeater: {
    id: 'bug_stack_repeater',
    name: '栈重复者',
    tier: TroopTier.TIER_2,
    basePower: 20,
    cost: 70,
    upgradeCost: 115,
    maxXp: 330,
    upgradeTargetId: 'bug_recursion_herald',
    description: '它像不断叠加的调用栈，让敌人喘不过气。【技能：层层压迫】提升压制力。',
    equipment: ['栈裂拳刃', '叠层护甲'],
    attributes: troopAttr(46, 40, 38, 60, 5, 60)
  },
  bug_recursion_herald: {
    id: 'bug_recursion_herald',
    name: '递归宣告者',
    tier: TroopTier.TIER_3,
    basePower: 42,
    cost: 180,
    upgradeCost: 220,
    maxXp: 860,
    upgradeTargetId: 'bug_stack_overflow_beast',
    description: '它的战吼像递归调用，无止境回响。【技能：递归回响】提升群体伤害。',
    equipment: ['递归战斧', '回声护肩'],
    attributes: troopAttr(80, 70, 55, 100, 10, 85)
  },
  bug_stack_overflow_beast: {
    id: 'bug_stack_overflow_beast',
    name: '栈溢出巨兽',
    tier: TroopTier.TIER_4,
    basePower: 98,
    cost: 580,
    upgradeCost: 780,
    maxXp: 1750,
    upgradeTargetId: 'bug_system_reset_leviathan',
    description: '它的力量会突破极限，像溢出的栈再也收不回。【技能：溢出猛击】高额重击。',
    equipment: ['溢出巨锤', '崩栈甲胄'],
    attributes: troopAttr(150, 120, 70, 170, 10, 110)
  },
  bug_system_reset_leviathan: {
    id: 'bug_system_reset_leviathan',
    name: '系统重置利维坦',
    tier: TroopTier.TIER_5,
    basePower: 210,
    cost: 1700,
    upgradeCost: 0,
    maxXp: 2700,
    description: '它能重置整片战场的节奏。【技能：系统重启】大范围冲击。',
    equipment: ['重启巨刃', '重置装甲'],
    attributes: troopAttr(220, 200, 75, 240, 20, 160)
  },

  // --- ROACH NEST (TIER 1-3) ---
  roach_brawler: {
    id: 'roach_brawler',
    name: '初级蟑螂棍手',
    tier: TroopTier.TIER_1,
    basePower: 7,
    cost: 15,
    upgradeCost: 35,
    maxXp: 999999,
    upgradeTargetId: 'roach_aerial_duelist',
    description: '魔法污染让它直立行走，还学会了抡棍。【技能：数量压迫】同类数量越多，越容易把你挤到墙角。不靠战斗经验升级，靠吞噬成长。',
    equipment: ['纸卷棍', '破碎护胸片'],
    attributes: troopAttr(25, 20, 45, 25, 5, 30)
  },
  roach_pikeman: {
    id: 'roach_pikeman',
    name: '初级蟑螂长矛手',
    tier: TroopTier.TIER_1,
    basePower: 8,
    cost: 16,
    upgradeCost: 35,
    maxXp: 999999,
    upgradeTargetId: 'roach_aerial_lancer',
    description: '拿着牙签当长矛，队形居然还挺像回事。【技能：刺戳连打】更容易在短时间内多次命中。不靠战斗经验升级，靠吞噬成长。',
    equipment: ['牙签长矛', '硬壳护臂'],
    attributes: troopAttr(25, 25, 45, 25, 15, 30)
  },
  roach_slinger: {
    id: 'roach_slinger',
    name: '初级蟑螂投石手',
    tier: TroopTier.TIER_1,
    basePower: 9,
    cost: 18,
    upgradeCost: 40,
    maxXp: 999999,
    upgradeTargetId: 'roach_aerial_harrier',
    description: '用瓶盖当弹丸，命中率不高，但胜在会乱丢。【技能：碎片飞溅】对密集目标更有威胁。不靠战斗经验升级，靠吞噬成长。',
    equipment: ['橡皮筋弹弓', '瓶盖弹丸'],
    attributes: troopAttr(20, 15, 45, 20, 60, 30)
  },
  roach_shieldling: {
    id: 'roach_shieldling',
    name: '初级蟑螂盾卫',
    tier: TroopTier.TIER_1,
    basePower: 10,
    cost: 20,
    upgradeCost: 45,
    maxXp: 999999,
    upgradeTargetId: 'roach_aerial_guard',
    description: '把便利店的塑料盖当盾，居然真的能挡几下。【技能：硬壳顶住】更难被远程压制。不靠战斗经验升级，靠吞噬成长。',
    equipment: ['塑料盖盾', '弯曲短刃'],
    attributes: troopAttr(20, 45, 40, 30, 5, 30)
  },

  roach_aerial_duelist: {
    id: 'roach_aerial_duelist',
    name: '熟练蟑螂斗士',
    tier: TroopTier.TIER_2,
    basePower: 20,
    cost: 55,
    upgradeCost: 95,
    maxXp: 999999,
    upgradeTargetId: 'roach_chitin_commander',
    description: '强化的肢体与保持飞行的能力，让它更像“会扑人脸的精英”。【技能：低空突袭】更容易击溃后排。',
    equipment: ['折断铁片刀', '强化翅鞘'],
    attributes: troopAttr(60, 40, 75, 50, 5, 60)
  },
  roach_aerial_lancer: {
    id: 'roach_aerial_lancer',
    name: '熟练蟑螂枪骑',
    tier: TroopTier.TIER_2,
    basePower: 22,
    cost: 58,
    upgradeCost: 100,
    maxXp: 999999,
    upgradeTargetId: 'roach_giant_halberdier',
    description: '它没有马，但有翅膀，冲刺时带着“嗡嗡的气势”。【技能：穿刺俯冲】对重甲更有效。',
    equipment: ['加长牙签枪', '翅鞘护甲'],
    attributes: troopAttr(60, 35, 75, 55, 25, 60)
  },
  roach_aerial_harrier: {
    id: 'roach_aerial_harrier',
    name: '熟练蟑螂骚扰者',
    tier: TroopTier.TIER_2,
    basePower: 24,
    cost: 60,
    upgradeCost: 105,
    maxXp: 999999,
    upgradeTargetId: 'roach_giant_gunner',
    description: '会飞的远程单位：你以为它在撤退，其实它在绕你背后丢垃圾。【技能：盘旋齐射】短时间多次远程压制。',
    equipment: ['裂纹玻璃弹', '临时弹袋'],
    attributes: troopAttr(55, 30, 80, 50, 110, 60)
  },
  roach_aerial_guard: {
    id: 'roach_aerial_guard',
    name: '熟练蟑螂近卫',
    tier: TroopTier.TIER_2,
    basePower: 26,
    cost: 65,
    upgradeCost: 110,
    maxXp: 999999,
    upgradeTargetId: 'roach_carapace_titan',
    description: '带盾还能飞，像一块会移动的盾牌飞向你。【技能：护翼格挡】显著提升大型单位的抗打击能力。',
    equipment: ['加固塑料盖盾', '胶带护甲'],
    attributes: troopAttr(40, 75, 65, 65, 5, 70)
  },

  roach_chitin_commander: {
    id: 'roach_chitin_commander',
    name: '精英蟑螂指挥官',
    tier: TroopTier.TIER_3,
    basePower: 55,
    cost: 180,
    upgradeCost: 0,
    maxXp: 999999,
    description: '它会战术，它会点名，它甚至会在战前说“嗡——”。【技能：虫群号令】显著提升周围蟑螂士气。',
    equipment: ['螺丝刀军刀', '指挥翅纹'],
    attributes: troopAttr(110, 100, 95, 100, 10, 150)
  },
  roach_giant_halberdier: {
    id: 'roach_giant_halberdier',
    name: '精英巨型武装蟑螂',
    tier: TroopTier.TIER_3,
    basePower: 50,
    cost: 160,
    upgradeCost: 0,
    maxXp: 999999,
    description: '体型巨大化，壳厚得像护甲板。【技能：硬壳装甲】大型单位拥有极高防御力。',
    equipment: ['铁丝戟', '重型甲壳'],
    attributes: troopAttr(100, 110, 55, 110, 15, 75)
  },
  roach_giant_gunner: {
    id: 'roach_giant_gunner',
    name: '精英巨型蟑螂炮手',
    tier: TroopTier.TIER_3,
    basePower: 48,
    cost: 155,
    upgradeCost: 0,
    maxXp: 999999,
    description: '它把“远程”理解为“把东西砸得更远”。【技能：弹雨倾泻】对密集阵型的压制更强。',
    equipment: ['弹簧投射器', '碎片弹盒'],
    attributes: troopAttr(100, 90, 55, 100, 150, 75)
  },
  roach_carapace_titan: {
    id: 'roach_carapace_titan',
    name: '精英甲壳泰坦蟑螂',
    tier: TroopTier.TIER_3,
    basePower: 60,
    cost: 210,
    upgradeCost: 0,
    maxXp: 999999,
    description: '像一堵会走路的墙，还是带触角的那种。【技能：堡垒化】大型单位获得极高防御力与韧性。',
    equipment: ['加固甲壳', '钝头撞槌'],
    attributes: troopAttr(85, 140, 40, 130, 5, 75)
  },
  heavy_ballista: {
    id: 'heavy_ballista',
    name: '重型弩车',
    tier: TroopTier.TIER_4,
    basePower: 95,
    cost: 900,
    upgradeCost: 0,
    maxXp: 999999,
    description: '用绞盘拉满弦，发射如木桩般粗的弩矢（初始弹药 18）。【技能：贯穿射击】对密集队列造成额外杀伤，且更容易击穿盾墙。',
    equipment: ['车弩', '绞盘组', '粗木盾板'],
    attributes: troopAttr(155, 55, 18, 95, 225, 120),
    category: 'HEAVY',
    heavyTier: 1,
    ammoPerUnit: 18,
    supportRole: 'ARTILLERY',
    supportRules: '每台弩车通常视为一个小型火力点；更擅长对盾墙与重甲造成有效伤害。弹药耗尽后压制能力会大幅下降。'
  },
  heavy_catapult: {
    id: 'heavy_catapult',
    name: '投石机',
    tier: TroopTier.TIER_4,
    basePower: 120,
    cost: 1200,
    upgradeCost: 0,
    maxXp: 999999,
    description: '把石头与坏情绪一起抛出去（初始弹药 12）。【技能：抛物线轰击】对阵型造成范围压制，容易打崩士气，但精度不稳定。',
    equipment: ['抛臂机架', '配重箱', '碎石弹袋'],
    attributes: troopAttr(200, 70, 10, 120, 200, 95),
    category: 'HEAVY',
    heavyTier: 2,
    ammoPerUnit: 12,
    supportRole: 'ARTILLERY',
    supportRules: '命中更看地形与阵型；开阔地更强，树林与山地更容易失效或误伤。'
  },
  heavy_bulwark_carriage: {
    id: 'heavy_bulwark_carriage',
    name: '移动堡垒车',
    tier: TroopTier.TIER_5,
    basePower: 180,
    cost: 2200,
    upgradeCost: 0,
    maxXp: 999999,
    description: '把铁皮、木板与誓言焊在一起的移动掩体（无弹药）。【技能：护城壳】为同层友军提供掩护，显著降低远程伤亡。',
    equipment: ['铆钉装甲板', '盾墙框架', '缓冲车轮'],
    attributes: troopAttr(85, 215, 35, 225, 0, 140),
    category: 'HEAVY',
    heavyTier: 3,
    ammoPerUnit: 0,
    supportRole: 'TANK',
    supportRules: '主要提供掩护与吸收火力；被火焰与爆裂类攻击克制。'
  },
  heavy_fire_cannon: {
    id: 'heavy_fire_cannon',
    name: '火晶火炮',
    tier: TroopTier.TIER_4,
    basePower: 140,
    cost: 1600,
    upgradeCost: 0,
    maxXp: 999999,
    description: '由法师驱动火属性水晶点燃炮弹（初始弹药 10）。【技能：火晶爆轰】对密集低阶目标造成额外伤害，但需要准备时间。',
    equipment: ['火晶炮管', '加固金属车架', '法师驱动席'],
    attributes: troopAttr(230, 60, 15, 70, 230, 110),
    category: 'HEAVY',
    heavyTier: 4,
    ammoPerUnit: 10,
    supportRole: 'ARTILLERY',
    supportRules: '炮击属于场外支援，前线崩溃时易失效；平原与开阔地威力更强。'
  },
  heavy_light_tank: {
    id: 'heavy_light_tank',
    name: '履带轻坦',
    tier: TroopTier.TIER_4,
    basePower: 155,
    cost: 1800,
    upgradeCost: 0,
    maxXp: 999999,
    description: '把火炮搬上履带底盘并轻量化（初始弹药 16）。【技能：穿阵冲撞】可在短时间内突破薄弱阵线。',
    equipment: ['轻量履带', '旋转炮塔', '缓冲装甲'],
    attributes: troopAttr(200, 170, 45, 160, 120, 120),
    category: 'HEAVY',
    heavyTier: 5,
    ammoPerUnit: 16,
    supportRole: 'TANK',
    supportRules: '重型单位前排更强，树林与山地机动受限；前线崩溃时战果骤降。'
  },
  heavy_arcane_radar: {
    id: 'heavy_arcane_radar',
    name: '奥术雷达阵列',
    tier: TroopTier.TIER_4,
    basePower: 110,
    cost: 1500,
    upgradeCost: 0,
    maxXp: 999999,
    description: '风晶驱动旋转，魔法探测水晶校准战场（无弹药）。【技能：解析锁定】降低敌军闪避并揭示隐匿。',
    equipment: ['风晶转子', '探测水晶', '稳定支架'],
    attributes: troopAttr(60, 120, 25, 80, 0, 180),
    category: 'HEAVY',
    heavyTier: 6,
    ammoPerUnit: 0,
    supportRole: 'RADAR',
    supportRules: '需要稳定战线维持扫描；被突入后迅速失效。'
  },
  roach_egg_thrower: {
    id: 'roach_egg_thrower',
    name: '蟑螂卵投石器',
    tier: TroopTier.TIER_3,
    basePower: 135,
    cost: 1400,
    upgradeCost: 0,
    maxXp: 999999,
    description: '蟑螂把卵包裹成硬球抛射（初始弹药 14）。【技能：虫潮爆发】命中后短时间内扰乱敌阵。',
    equipment: ['甲壳抛臂', '卵袋弹仓'],
    attributes: troopAttr(210, 80, 20, 90, 210, 130),
    category: 'HEAVY',
    heavyTier: 7,
    ammoPerUnit: 14,
    supportRole: 'ARTILLERY',
    supportRules: '对低阶兵群特攻，近战突入会让其迅速失效。'
  },
  imposter_flux_mortar: {
    id: 'imposter_flux_mortar',
    name: '伪人相位迫击炮',
    tier: TroopTier.TIER_5,
    basePower: 200,
    cost: 2600,
    upgradeCost: 0,
    maxXp: 999999,
    description: '用错位晶体扭曲弹道（初始弹药 9）。【技能：相位震荡】忽略部分护甲并扰乱士气。',
    equipment: ['相位晶体', '折叠炮架', '轨迹校准器'],
    attributes: troopAttr(235, 90, 30, 100, 240, 150),
    category: 'HEAVY',
    heavyTier: 8,
    ammoPerUnit: 9,
    supportRole: 'ARTILLERY',
    supportRules: '对重甲有奇效，但精度极其依赖地形稳定度。'
  },
  undead_soul_obelisk: {
    id: 'undead_soul_obelisk',
    name: '亡灵魂能方尖碑',
    tier: TroopTier.TIER_5,
    basePower: 175,
    cost: 2300,
    upgradeCost: 0,
    maxXp: 999999,
    description: '亡灵用灵魂水晶驱动的战场共鸣塔（无弹药）。【技能：恐惧回响】削弱敌军士气并放大阵线崩溃。',
    equipment: ['魂晶阵列', '骨质塔架', '哀嚎共振盘'],
    attributes: troopAttr(70, 140, 15, 140, 0, 220),
    category: 'HEAVY',
    heavyTier: 9,
    ammoPerUnit: 0,
    supportRole: 'RADAR',
    supportRules: '友军需要在其范围内才能受益，前线破裂后会迅速熄灭。'
  },
  hotpot_broth_howler: {
    id: 'hotpot_broth_howler',
    name: '食府汤锅轰鸣器',
    tier: TroopTier.TIER_4,
    basePower: 160,
    cost: 1900,
    upgradeCost: 0,
    maxXp: 999999,
    description: '用沸腾汤底与香料蒸汽轰击（初始弹药 12）。【技能：麻辣雾爆】命中后降低敌军闪避并缓速。',
    equipment: ['沸腾锅炉', '辣油喷口', '隔热护板'],
    attributes: troopAttr(195, 110, 25, 120, 200, 140),
    category: 'HEAVY',
    heavyTier: 10,
    ammoPerUnit: 12,
    supportRole: 'ARTILLERY',
    supportRules: '更适合平原与城外开阔地，雨雪天气削弱效果。'
  },
  beast_primate_juvenile_chimp: {
    id: 'beast_primate_juvenile_chimp',
    name: '幼年黑猩猩',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 24,
    cost: 160,
    upgradeCost: 220,
    maxXp: 80,
    upgradeTargetId: 'beast_primate_adult_gorilla',
    description: '灵长类入门单位，反应快、爆发高，但护甲几乎为零。',
    equipment: ['拳头', '獠牙'],
    attributes: troopAttr(70, 35, 95, 70, 5, 60)
  },
  beast_primate_adult_gorilla: {
    id: 'beast_primate_adult_gorilla',
    name: '成年大猩猩',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 55,
    cost: 320,
    upgradeCost: 480,
    maxXp: 150,
    upgradeTargetId: 'beast_primate_silverback',
    description: '肌肉与骨骼开始承担军阵责任，能用蛮力撕开盾墙。',
    equipment: ['巨臂', '厚皮'],
    attributes: troopAttr(110, 70, 80, 120, 5, 90)
  },
  beast_primate_silverback: {
    id: 'beast_primate_silverback',
    name: '银背大猩猩',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 105,
    cost: 650,
    upgradeCost: 900,
    maxXp: 300,
    upgradeTargetId: 'beast_primate_giant_legacy',
    description: '族群领袖的体格与气势，爆发力足以碾碎前排。',
    equipment: ['钢铁般的拳', '咆哮'],
    attributes: troopAttr(145, 95, 85, 160, 5, 120)
  },
  beast_primate_giant_legacy: {
    id: 'beast_primate_giant_legacy',
    name: '巨猿遗脉',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 170,
    cost: 1200,
    upgradeCost: 1600,
    maxXp: 600,
    upgradeTargetId: 'beast_primate_kong_prototype',
    description: '古老血脉醒来，力量与耐久压制一切花活。',
    equipment: ['碎岩拳', '厚重骨甲'],
    attributes: troopAttr(180, 120, 70, 200, 5, 150)
  },
  beast_primate_kong_prototype: {
    id: 'beast_primate_kong_prototype',
    name: '金刚原型',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 240,
    cost: 2200,
    upgradeCost: 0,
    maxXp: 2000,
    description: '巨兽的原型，像移动的攻城槌。',
    equipment: ['泰坦级臂力', '撕裂'],
    attributes: troopAttr(220, 150, 65, 230, 5, 190)
  },
  beast_rhino_calf: {
    id: 'beast_rhino_calf',
    name: '幼年犀牛',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 26,
    cost: 170,
    upgradeCost: 240,
    maxXp: 90,
    upgradeTargetId: 'beast_rhino_black_subadult',
    description: '重装甲类入门，皮厚耐打，冲撞能打乱阵型。',
    equipment: ['小角', '厚皮'],
    attributes: troopAttr(85, 70, 45, 110, 5, 90)
  },
  beast_rhino_black_subadult: {
    id: 'beast_rhino_black_subadult',
    name: '亚成体黑犀牛',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 60,
    cost: 340,
    upgradeCost: 520,
    maxXp: 170,
    upgradeTargetId: 'beast_rhino_white_warrior',
    description: '冲刺距离更长，穿刺更狠，能顶穿散阵。',
    equipment: ['尖角', '厚皮'],
    attributes: troopAttr(115, 95, 55, 150, 5, 120)
  },
  beast_rhino_white_warrior: {
    id: 'beast_rhino_white_warrior',
    name: '白犀牛武士',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 115,
    cost: 700,
    upgradeCost: 980,
    maxXp: 320,
    upgradeTargetId: 'beast_rhino_iron_unicorn',
    description: '披甲般的角质与骨板，正面推进几乎不停。',
    equipment: ['战角', '甲壳皮'],
    attributes: troopAttr(150, 130, 55, 190, 5, 150)
  },
  beast_rhino_iron_unicorn: {
    id: 'beast_rhino_iron_unicorn',
    name: '独角铁甲犀',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 180,
    cost: 1300,
    upgradeCost: 1750,
    maxXp: 650,
    upgradeTargetId: 'beast_rhino_elasmotherium',
    description: '重装冲锋的化身，能把步兵阵列硬生生推开。',
    equipment: ['铁甲角', '重皮甲'],
    attributes: troopAttr(185, 160, 60, 220, 5, 175)
  },
  beast_rhino_elasmotherium: {
    id: 'beast_rhino_elasmotherium',
    name: '板齿犀',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 255,
    cost: 2400,
    upgradeCost: 0,
    maxXp: 2000,
    description: '远古巨兽，穿刺与碾压同时发生。',
    equipment: ['远古巨角', '厚重骨板'],
    attributes: troopAttr(215, 185, 55, 245, 5, 200)
  },
  beast_hippo_calf: {
    id: 'beast_hippo_calf',
    name: '幼年河马',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 26,
    cost: 160,
    upgradeCost: 240,
    maxXp: 90,
    upgradeTargetId: 'beast_hippo_swamp',
    description: '重型坦克入门，咬合与体重就是护甲。',
    equipment: ['钝齿', '厚皮'],
    attributes: troopAttr(90, 70, 40, 125, 5, 85)
  },
  beast_hippo_swamp: {
    id: 'beast_hippo_swamp',
    name: '沼泽河马',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 62,
    cost: 330,
    upgradeCost: 520,
    maxXp: 170,
    upgradeTargetId: 'beast_hippo_raging_bull',
    description: '更耐打，更难停下，适合硬顶前线。',
    equipment: ['重咬合', '泥甲'],
    attributes: troopAttr(120, 95, 45, 165, 5, 120)
  },
  beast_hippo_raging_bull: {
    id: 'beast_hippo_raging_bull',
    name: '暴怒公河马',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 120,
    cost: 720,
    upgradeCost: 1000,
    maxXp: 320,
    upgradeTargetId: 'beast_hippo_bloodpool_lord',
    description: '愤怒与咬合堆成一面墙，近战会被拖进泥里。',
    equipment: ['巨颚', '厚皮'],
    attributes: troopAttr(155, 120, 50, 200, 5, 150)
  },
  beast_hippo_bloodpool_lord: {
    id: 'beast_hippo_bloodpool_lord',
    name: '血池霸主',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 190,
    cost: 1350,
    upgradeCost: 1750,
    maxXp: 650,
    upgradeTargetId: 'beast_hippo_terror_giant',
    description: '体型放大到能把战线压塌，咬合无视恐惧。',
    equipment: ['断骨巨颚', '战痕厚皮'],
    attributes: troopAttr(190, 150, 55, 235, 5, 175)
  },
  beast_hippo_terror_giant: {
    id: 'beast_hippo_terror_giant',
    name: '恐河马',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 260,
    cost: 2500,
    upgradeCost: 0,
    maxXp: 2000,
    description: '巨型化的河马怪物，咬合像合拢的城门。',
    equipment: ['巨型断头咬合', '钢筋般的肌肉'],
    attributes: troopAttr(220, 175, 50, 255, 5, 195)
  },
  beast_elephant_calf: {
    id: 'beast_elephant_calf',
    name: '幼年非洲象',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 28,
    cost: 180,
    upgradeCost: 260,
    maxXp: 100,
    upgradeTargetId: 'beast_elephant_bush',
    description: '长鼻系入门，耐久优秀，力量会随成长爆炸。',
    equipment: ['短鼻', '厚皮'],
    attributes: troopAttr(95, 85, 35, 140, 5, 90)
  },
  beast_elephant_bush: {
    id: 'beast_elephant_bush',
    name: '成年灌木象',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 70,
    cost: 360,
    upgradeCost: 560,
    maxXp: 190,
    upgradeTargetId: 'beast_elephant_musth_bull',
    description: '体型成型后，冲撞几乎等同攻城器械。',
    equipment: ['长鼻', '厚皮'],
    attributes: troopAttr(130, 110, 40, 190, 5, 130)
  },
  beast_elephant_musth_bull: {
    id: 'beast_elephant_musth_bull',
    name: '非洲雄象（发情期）',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 130,
    cost: 780,
    upgradeCost: 1050,
    maxXp: 350,
    upgradeTargetId: 'beast_elephant_warleader',
    description: '力量与狂暴叠加，冲锋会带走整条前排。',
    equipment: ['象牙', '怒意'],
    attributes: troopAttr(165, 140, 45, 230, 5, 160)
  },
  beast_elephant_warleader: {
    id: 'beast_elephant_warleader',
    name: '战象领袖',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 205,
    cost: 1500,
    upgradeCost: 1900,
    maxXp: 750,
    upgradeTargetId: 'beast_elephant_mammoth',
    description: '战场中心的重压，带着整支兽群往前推。',
    equipment: ['巨象牙', '铁蹄'],
    attributes: troopAttr(195, 170, 45, 255, 5, 185)
  },
  beast_elephant_mammoth: {
    id: 'beast_elephant_mammoth',
    name: '猛犸象',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 270,
    cost: 2700,
    upgradeCost: 0,
    maxXp: 2000,
    description: '远古的长鼻巨兽，践踏会把阵线踩成碎屑。',
    equipment: ['远古象牙', '冻土厚毛'],
    attributes: troopAttr(225, 195, 40, 255, 5, 210)
  },
  beast_lion_cub: {
    id: 'beast_lion_cub',
    name: '幼年雄狮',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 24,
    cost: 160,
    upgradeCost: 220,
    maxXp: 80,
    upgradeTargetId: 'beast_lion_wanderer',
    description: '猫科入门，敏捷与杀戮本能会快速成型。',
    equipment: ['利爪', '獠牙'],
    attributes: troopAttr(80, 45, 90, 80, 5, 70)
  },
  beast_lion_wanderer: {
    id: 'beast_lion_wanderer',
    name: '流浪雄狮',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 58,
    cost: 330,
    upgradeCost: 500,
    maxXp: 160,
    upgradeTargetId: 'beast_lion_pride_king',
    description: '单独狩猎的猛兽，速度与爆发兼具。',
    equipment: ['锋爪', '撕咬'],
    attributes: troopAttr(110, 70, 95, 115, 5, 110)
  },
  beast_lion_pride_king: {
    id: 'beast_lion_pride_king',
    name: '狮群之王',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 115,
    cost: 700,
    upgradeCost: 980,
    maxXp: 320,
    upgradeTargetId: 'beast_lion_giant_savage',
    description: '战场嗅觉敏锐，能抓住破绽持续斩杀。',
    equipment: ['王者獠牙', '利爪'],
    attributes: troopAttr(145, 95, 105, 150, 5, 140)
  },
  beast_lion_giant_savage: {
    id: 'beast_lion_giant_savage',
    name: '蛮荒巨狮',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 185,
    cost: 1350,
    upgradeCost: 1750,
    maxXp: 650,
    upgradeTargetId: 'beast_lion_ancient_brutal',
    description: '体型与速度同时提升，突入后排像刀切黄油。',
    equipment: ['巨爪', '蛮荒怒意'],
    attributes: troopAttr(180, 120, 110, 190, 5, 170)
  },
  beast_lion_ancient_brutal: {
    id: 'beast_lion_ancient_brutal',
    name: '残暴狮（远古种）',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 250,
    cost: 2500,
    upgradeCost: 0,
    maxXp: 2000,
    description: '远古杀戮本能回归，攻击与机动都极其致命。',
    equipment: ['远古獠牙', '裂肉爪'],
    attributes: troopAttr(210, 150, 105, 220, 5, 195)
  },
  beast_tiger_cub: {
    id: 'beast_tiger_cub',
    name: '幼年孟加拉虎',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 25,
    cost: 170,
    upgradeCost: 230,
    maxXp: 85,
    upgradeTargetId: 'beast_tiger_jungle_hunter',
    description: '虎系入门，单兵强度会迅速拉开差距。',
    equipment: ['利爪', '獠牙'],
    attributes: troopAttr(85, 50, 95, 85, 5, 75)
  },
  beast_tiger_jungle_hunter: {
    id: 'beast_tiger_jungle_hunter',
    name: '丛林猎手',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 62,
    cost: 340,
    upgradeCost: 520,
    maxXp: 175,
    upgradeTargetId: 'beast_tiger_siberian',
    description: '伏击与爆发兼备，专挑重甲的缝隙下手。',
    equipment: ['狩猎利爪', '撕咬'],
    attributes: troopAttr(120, 75, 105, 125, 5, 115)
  },
  beast_tiger_siberian: {
    id: 'beast_tiger_siberian',
    name: '东北虎（西伯利亚）',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 125,
    cost: 760,
    upgradeCost: 1040,
    maxXp: 340,
    upgradeTargetId: 'beast_tiger_sabertooth_spirit',
    description: '体格与耐久更强，仍保留可怕的机动。',
    equipment: ['重爪', '寒地肌肉'],
    attributes: troopAttr(155, 95, 110, 170, 5, 145)
  },
  beast_tiger_sabertooth_spirit: {
    id: 'beast_tiger_sabertooth_spirit',
    name: '剑齿虎魂',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 195,
    cost: 1450,
    upgradeCost: 1900,
    maxXp: 720,
    upgradeTargetId: 'beast_tiger_giant_sabertooth',
    description: '远古捕食者的残影，攻击更专注于一击毙命。',
    equipment: ['长剑齿', '猎杀本能'],
    attributes: troopAttr(190, 125, 105, 210, 5, 175)
  },
  beast_tiger_giant_sabertooth: {
    id: 'beast_tiger_giant_sabertooth',
    name: '巨型剑齿虎',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 260,
    cost: 2600,
    upgradeCost: 0,
    maxXp: 2000,
    description: '巨型化的剑齿虎，靠单兵强度撕开任何阵线。',
    equipment: ['巨齿', '裂甲利爪'],
    attributes: troopAttr(220, 155, 100, 240, 5, 195)
  },
  beast_bear_cub: {
    id: 'beast_bear_cub',
    name: '幼年棕熊',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 26,
    cost: 160,
    upgradeCost: 240,
    maxXp: 90,
    upgradeTargetId: 'beast_bear_grizzly',
    description: '熊系入门，全能重装，适合当战线填充。',
    equipment: ['利爪', '厚皮'],
    attributes: troopAttr(80, 60, 55, 110, 5, 85)
  },
  beast_bear_grizzly: {
    id: 'beast_bear_grizzly',
    name: '森林灰熊',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 64,
    cost: 330,
    upgradeCost: 520,
    maxXp: 175,
    upgradeTargetId: 'beast_bear_kodiak',
    description: '力量与耐久稳步成长，能扛能打。',
    equipment: ['钢爪', '厚皮'],
    attributes: troopAttr(115, 90, 60, 155, 5, 120)
  },
  beast_bear_kodiak: {
    id: 'beast_bear_kodiak',
    name: '科迪亚克棕熊',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 130,
    cost: 760,
    upgradeCost: 1040,
    maxXp: 350,
    upgradeTargetId: 'beast_bear_polar_butcher',
    description: '超大体型，几乎是移动的盾墙。',
    equipment: ['巨爪', '厚脂'],
    attributes: troopAttr(150, 120, 65, 200, 5, 150)
  },
  beast_bear_polar_butcher: {
    id: 'beast_bear_polar_butcher',
    name: '极地屠夫（北极熊）',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 205,
    cost: 1450,
    upgradeCost: 1900,
    maxXp: 720,
    upgradeTargetId: 'beast_bear_short_faced',
    description: '寒地顶级捕食者，护甲与杀伤同时在线。',
    equipment: ['雪原巨爪', '撕咬'],
    attributes: troopAttr(185, 145, 70, 235, 5, 180)
  },
  beast_bear_short_faced: {
    id: 'beast_bear_short_faced',
    name: '短面熊',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 270,
    cost: 2700,
    upgradeCost: 0,
    maxXp: 2000,
    description: '陆地最强捕食者之一，正面接战几乎不会退。',
    equipment: ['短面重咬合', '巨爪'],
    attributes: troopAttr(215, 175, 65, 255, 5, 200)
  },
  beast_wolf_grey: {
    id: 'beast_wolf_grey',
    name: '灰狼',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 20,
    cost: 130,
    upgradeCost: 200,
    maxXp: 70,
    upgradeTargetId: 'beast_wolf_king',
    description: '犬科入门，依靠集群与耐力拖垮敌人。',
    equipment: ['利齿', '爪'],
    attributes: troopAttr(65, 35, 105, 70, 5, 65)
  },
  beast_wolf_king: {
    id: 'beast_wolf_king',
    name: '荒野狼王',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 52,
    cost: 280,
    upgradeCost: 450,
    maxXp: 150,
    upgradeTargetId: 'beast_wolf_tundra_giant',
    description: '狼群核心，速度与士气更强。',
    equipment: ['撕咬', '怒嚎'],
    attributes: troopAttr(95, 55, 115, 105, 5, 110)
  },
  beast_wolf_tundra_giant: {
    id: 'beast_wolf_tundra_giant',
    name: '冻原巨狼',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 105,
    cost: 650,
    upgradeCost: 900,
    maxXp: 300,
    upgradeTargetId: 'beast_wolf_dire_orphan',
    description: '更大、更快、更耐打，适合持续追击。',
    equipment: ['巨齿', '冻原肌肉'],
    attributes: troopAttr(125, 80, 110, 140, 5, 140)
  },
  beast_wolf_dire_orphan: {
    id: 'beast_wolf_dire_orphan',
    name: '恐狼遗孤',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 170,
    cost: 1200,
    upgradeCost: 1600,
    maxXp: 600,
    upgradeTargetId: 'beast_wolf_fenrir',
    description: '古种血脉回归，咬合能撕开铠甲接缝。',
    equipment: ['恐狼獠牙', '残酷耐力'],
    attributes: troopAttr(160, 110, 105, 185, 5, 170)
  },
  beast_wolf_fenrir: {
    id: 'beast_wolf_fenrir',
    name: '芬里尔',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 240,
    cost: 2400,
    upgradeCost: 0,
    maxXp: 2000,
    description: '概念化的巨狼，速度与杀伤同时达到极限。',
    equipment: ['概念獠牙', '终末嚎叫'],
    attributes: troopAttr(195, 140, 100, 220, 5, 200)
  },
  beast_croc_nile_juvenile: {
    id: 'beast_croc_nile_juvenile',
    name: '幼体尼罗鳄',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 22,
    cost: 140,
    upgradeCost: 210,
    maxXp: 75,
    upgradeTargetId: 'beast_croc_wetland_giant',
    description: '爬行类入门，伏击与咬合是全部逻辑。',
    equipment: ['利齿', '鳞甲'],
    attributes: troopAttr(70, 60, 50, 115, 5, 75)
  },
  beast_croc_wetland_giant: {
    id: 'beast_croc_wetland_giant',
    name: '湿地巨鳄',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 58,
    cost: 310,
    upgradeCost: 500,
    maxXp: 160,
    upgradeTargetId: 'beast_croc_saltwater',
    description: '鳞甲更硬，咬合更凶，能把敌人拖下线。',
    equipment: ['巨颚', '鳞甲'],
    attributes: troopAttr(105, 90, 55, 160, 5, 120)
  },
  beast_croc_saltwater: {
    id: 'beast_croc_saltwater',
    name: '咸水鳄（湾鳄）',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 120,
    cost: 720,
    upgradeCost: 1000,
    maxXp: 320,
    upgradeTargetId: 'beast_croc_prehistoric_killer',
    description: '力量与护甲都达标，正面接战也能赢。',
    equipment: ['重颚', '厚鳞'],
    attributes: troopAttr(135, 120, 55, 200, 5, 150)
  },
  beast_croc_prehistoric_killer: {
    id: 'beast_croc_prehistoric_killer',
    name: '史前杀手',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 190,
    cost: 1400,
    upgradeCost: 1850,
    maxXp: 720,
    upgradeTargetId: 'beast_croc_deinosuchus',
    description: '体型逼近怪物，咬合能把整排拖进混乱。',
    equipment: ['史前巨颚', '骨板鳞甲'],
    attributes: troopAttr(170, 150, 60, 235, 5, 175)
  },
  beast_croc_deinosuchus: {
    id: 'beast_croc_deinosuchus',
    name: '帝鳄',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 255,
    cost: 2550,
    upgradeCost: 0,
    maxXp: 2000,
    description: '猎龙者级别的帝鳄，咬合带着碾碎般的压迫。',
    equipment: ['帝鳄巨颚', '装甲鳞片'],
    attributes: troopAttr(205, 175, 55, 255, 5, 195)
  },
  beast_bison_calf: {
    id: 'beast_bison_calf',
    name: '幼年野牛',
    race: 'BEAST',
    tier: TroopTier.TIER_1,
    basePower: 24,
    cost: 150,
    upgradeCost: 220,
    maxXp: 80,
    upgradeTargetId: 'beast_bison_african_buffalo',
    description: '牛科入门，冲撞与耐力是核心。',
    equipment: ['小角', '厚皮'],
    attributes: troopAttr(75, 60, 55, 110, 5, 85)
  },
  beast_bison_african_buffalo: {
    id: 'beast_bison_african_buffalo',
    name: '非洲水牛',
    race: 'BEAST',
    tier: TroopTier.TIER_2,
    basePower: 60,
    cost: 310,
    upgradeCost: 500,
    maxXp: 160,
    upgradeTargetId: 'beast_bison_rabid_king',
    description: '更重、更狠，能顶着箭雨冲到脸上。',
    equipment: ['硬角', '厚皮'],
    attributes: troopAttr(110, 90, 60, 155, 5, 120)
  },
  beast_bison_rabid_king: {
    id: 'beast_bison_rabid_king',
    name: '狂暴野牛王',
    race: 'BEAST',
    tier: TroopTier.TIER_3,
    basePower: 120,
    cost: 700,
    upgradeCost: 980,
    maxXp: 320,
    upgradeTargetId: 'beast_bison_wasteland_heavy',
    description: '冲锋如破城槌，正面硬顶能力很强。',
    equipment: ['战角', '狂暴'],
    attributes: troopAttr(145, 120, 65, 195, 5, 150)
  },
  beast_bison_wasteland_heavy: {
    id: 'beast_bison_wasteland_heavy',
    name: '荒原重骑',
    race: 'BEAST',
    tier: TroopTier.TIER_4,
    basePower: 190,
    cost: 1350,
    upgradeCost: 1800,
    maxXp: 720,
    upgradeTargetId: 'beast_bison_siberian_ancient',
    description: '靠体重与冲撞碾压阵线，适合打碎防守。',
    equipment: ['重角', '荒原铁蹄'],
    attributes: troopAttr(175, 150, 65, 230, 5, 175)
  },
  beast_bison_siberian_ancient: {
    id: 'beast_bison_siberian_ancient',
    name: '西伯利亚野牛（远古）',
    race: 'BEAST',
    tier: TroopTier.TIER_5,
    basePower: 250,
    cost: 2500,
    upgradeCost: 0,
    maxXp: 2000,
    description: '远古血脉的重装野牛，碾压与耐久同时拉满。',
    equipment: ['远古重角', '冻土厚毛'],
    attributes: troopAttr(205, 175, 60, 255, 5, 195)
  },
};

export const TROOP_TEMPLATES: Record<string, Omit<Troop, 'count' | 'xp'>> = Object.fromEntries(
  Object.entries(RAW_TROOP_TEMPLATES).map(([id, template]) => [
    id,
    { ...template, attributes: normalizeAttributes(template.attributes, template.tier) }
  ])
) as Record<string, Omit<Troop, 'count' | 'xp'>>;

export const BUG_SUMMON_RECIPES: BugSummonRecipe[] = [
  { id: 'bug_null_pointer_scout', name: '空指针侦察者', components: ['空指针'], troopId: 'bug_null_pointer_scout', tier: TroopTier.TIER_1, description: '轻量级的空指针涌动。' },
  { id: 'bug_seg_fault_guard', name: '段错误守卫', components: ['空指针', '段错误'], troopId: 'bug_seg_fault_guard', tier: TroopTier.TIER_2, description: '越界一步就会触发反击。' },
  { id: 'bug_memory_leak_reaver', name: '内存泄漏劫掠者', components: ['空指针', '内存泄漏'], troopId: 'bug_memory_leak_reaver', tier: TroopTier.TIER_3, description: '敌军资源不断流失。' },
  { id: 'bug_heap_corruptor', name: '堆破坏者', components: ['内存泄漏', '堆破坏'], troopId: 'bug_heap_corruptor', tier: TroopTier.TIER_4, description: '后勤被拖入崩塌。' },
  { id: 'bug_kernel_panic_titan', name: '内核恐慌泰坦', components: ['堆破坏', '内核恐慌'], troopId: 'bug_kernel_panic_titan', tier: TroopTier.TIER_5, description: '让敌军系统失稳。' },

  { id: 'bug_off_by_one_runner', name: '偏一疾行者', components: ['偏一错误'], troopId: 'bug_off_by_one_runner', tier: TroopTier.TIER_1, description: '总能多走一步。' },
  { id: 'bug_boundary_skirmisher', name: '边界游击兵', components: ['偏一错误', '边界越界'], troopId: 'bug_boundary_skirmisher', tier: TroopTier.TIER_2, description: '割裂阵线边界。' },
  { id: 'bug_index_outlaw', name: '索引亡命徒', components: ['索引失配'], troopId: 'bug_index_outlaw', tier: TroopTier.TIER_3, description: '错位打击敌阵。' },
  { id: 'bug_array_overrun_ravager', name: '数组溢出掠夺者', components: ['边界越界', '数组溢出'], troopId: 'bug_array_overrun_ravager', tier: TroopTier.TIER_4, description: '阵型被挤出格子。' },
  { id: 'bug_buffer_overrun_colossus', name: '缓冲溢出巨像', components: ['数组溢出', '缓冲溢出'], troopId: 'bug_buffer_overrun_colossus', tier: TroopTier.TIER_5, description: '冲击碾压防线。' },

  { id: 'bug_race_condition_scout', name: '竞态斥候', components: ['竞态条件'], troopId: 'bug_race_condition_scout', tier: TroopTier.TIER_1, description: '先手干扰敌军节奏。' },
  { id: 'bug_deadlock_enforcer', name: '死锁执法者', components: ['竞态条件', '死锁'], troopId: 'bug_deadlock_enforcer', tier: TroopTier.TIER_2, description: '封锁敌军机动。' },
  { id: 'bug_livelock_duelist', name: '活锁决斗者', components: ['死锁', '活锁'], troopId: 'bug_livelock_duelist', tier: TroopTier.TIER_3, description: '耗尽敌军士气。' },
  { id: 'bug_threadstorm_savant', name: '线程风暴贤者', components: ['活锁', '线程风暴'], troopId: 'bug_threadstorm_savant', tier: TroopTier.TIER_4, description: '大范围扰乱敌阵。' },
  { id: 'bug_concurrency_overlord', name: '并发霸主', components: ['线程风暴', '并发失序'], troopId: 'bug_concurrency_overlord', tier: TroopTier.TIER_5, description: '压制敌军指挥效率。' },

  { id: 'bug_float_drift_apprentice', name: '浮点漂移学徒', components: ['浮点漂移'], troopId: 'bug_float_drift_apprentice', tier: TroopTier.TIER_1, description: '箭矢难以捕捉。' },
  { id: 'bug_precision_sniper', name: '精度狙击手', components: ['浮点漂移', '精度损失'], troopId: 'bug_precision_sniper', tier: TroopTier.TIER_2, description: '致命的一位小数。' },
  { id: 'bug_nan_oracle', name: 'NaN 先知', components: ['精度损失', 'NaN'], troopId: 'bug_nan_oracle', tier: TroopTier.TIER_3, description: '让判定失效。' },
  { id: 'bug_underflow_prophet', name: '下溢预言者', components: ['NaN', '下溢'], troopId: 'bug_underflow_prophet', tier: TroopTier.TIER_4, description: '力量逐渐枯竭。' },
  { id: 'bug_overflow_cataclysm', name: '上溢灾变者', components: ['下溢', '上溢'], troopId: 'bug_overflow_cataclysm', tier: TroopTier.TIER_5, description: '能量溢出成灾。' },

  { id: 'bug_syntax_error_mender', name: '语法错修匠', components: ['语法错误'], troopId: 'bug_syntax_error_mender', tier: TroopTier.TIER_1, description: '错位斩击。' },
  { id: 'bug_parser_cutlass', name: '解析弯刀客', components: ['语法错误', '解析失败'], troopId: 'bug_parser_cutlass', tier: TroopTier.TIER_2, description: '拆解敌阵结构。' },
  { id: 'bug_compiler_hexer', name: '编译诅咒师', components: ['解析失败', '编译报错'], troopId: 'bug_compiler_hexer', tier: TroopTier.TIER_3, description: '让敌军无法通过。' },
  { id: 'bug_build_breaker', name: '构建破坏者', components: ['编译报错', '构建失败'], troopId: 'bug_build_breaker', tier: TroopTier.TIER_4, description: '补给线崩断。' },
  { id: 'bug_ci_apocalypse', name: 'CI 末日使', components: ['构建失败', 'CI 崩溃'], troopId: 'bug_ci_apocalypse', tier: TroopTier.TIER_5, description: '持续失败警报。' },

  { id: 'bug_infinite_loop_monk', name: '循环苦行僧', components: ['无限循环'], troopId: 'bug_infinite_loop_monk', tier: TroopTier.TIER_1, description: '连击循环不止。' },
  { id: 'bug_stack_repeater', name: '栈重复者', components: ['无限循环', '调用栈膨胀'], troopId: 'bug_stack_repeater', tier: TroopTier.TIER_2, description: '压迫敌军节奏。' },
  { id: 'bug_recursion_herald', name: '递归宣告者', components: ['调用栈膨胀', '递归回响'], troopId: 'bug_recursion_herald', tier: TroopTier.TIER_3, description: '群体回声打击。' },
  { id: 'bug_stack_overflow_beast', name: '栈溢出巨兽', components: ['递归回响', '栈溢出'], troopId: 'bug_stack_overflow_beast', tier: TroopTier.TIER_4, description: '突破极限重击。' },
  { id: 'bug_system_reset_leviathan', name: '系统重置利维坦', components: ['栈溢出', '系统重置'], troopId: 'bug_system_reset_leviathan', tier: TroopTier.TIER_5, description: '重置战场节奏。' }
];

const getAnomalyCrystal = (recipe: BugSummonRecipe): MineralId => {
  const text = `${recipe.name}${recipe.description}${recipe.components.join('')}`;
  if (/死锁|竞态|活锁|线程|并发/.test(text)) return 'DEADLOCK_SHARD';
  if (/栈|递归|循环|溢出|偏一|索引|数组|缓冲|浮点|NaN|上溢|下溢/.test(text)) return 'STACK_OVERFLOW';
  return 'NULL_CRYSTAL';
};

export const ANOMALY_CATALOG: Anomaly[] = BUG_SUMMON_RECIPES.map(recipe => ({
  id: recipe.id,
  name: recipe.name,
  crystal: getAnomalyCrystal(recipe),
  troopId: recipe.troopId,
  tier: recipe.tier,
  description: recipe.description
}));

export const PARROT_VARIANTS: ParrotVariant[] = [
  { name: '玄风鹦鹉', type: 'XUANFENG', color: 'text-slate-300', price: 40, personality: 'MANIC', description: '最便宜的吵闹鸟，基本只会乱叫。' },
  { name: '虎皮鹦鹉', type: 'BUDGERIGAR', color: 'text-lime-400', price: 60, personality: 'MANIC', description: '活泼又聒噪，学不会战术，只会学你骂人。' },
  { name: '蓝黄金刚鹦鹉', type: 'MACAW', color: 'text-blue-400', price: 100, personality: 'SARCASTIC', description: '羽毛华丽，嘴巴却很毒。喜欢在关键时刻嘲讽你的战术。' },
  { name: '月轮鹦鹉', type: 'PARAKEET', color: 'text-green-600', price: 150, personality: 'GLOOMY', description: '总是低着头，仿佛看透了这世间的苦难。它预言的坏事通常都很准。' },
  { name: '非洲灰鹦鹉', type: 'GREY', color: 'text-stone-400', price: 500, personality: 'WISE', description: '智商极高，眼神深邃。偶尔会引用古代哲学家的名言，或者纠正你的语法。' },
  { name: '葵花凤头鹦鹉', type: 'COCKATOO', color: 'text-yellow-200', price: 300, personality: 'MANIC', description: '拥有莫西干发型的摇滚明星。大部分时间在尖叫，极度亢奋。' },
];

export const ENEMY_QUOTES: Record<string, string[]> = {
  'peasant': ["别杀我们！我们只是想要点面包！", "把钱交出来，你可以滚了！", "兄弟们，这就是那只肥羊！"],
  'militia': ["此处禁止通行！除非...嘿嘿。", "这片沙漠归我们管！", "留下买路财！"],
  'hunter': ["森林会埋葬你们。", "你的头骨会是很好的装饰品。", "嘘...猎物上钩了。"],
  'footman': ["以钢铁之名，碾碎他们！", "北境不需要弱者。", "把他们的头砍下来当酒杯！"],
  'knight': ["叛徒？不，我们是新的秩序！", "为了被遗忘的荣耀！", "向我的剑刃下跪！"],
  'zealot': ["血祭血神！", "火焰会净化一切！", "为了末日的降临！献身吧！"],
  'wolf_rider': ["肉！新鲜的肉！", "撕碎他们！", "嗷呜————！"],
  'automaton': ["目标锁定...歼灭模式启动...", "检测到有机生命体...清除...", "指令：毁灭。"],
  'skeleton_warrior': ["加入我们...成为永恒...", "这里只有死亡...", "大脑...新鲜的大脑..."],
  'void_caller': ["深渊正在凝视你...", "你的理智...如此脆弱...", "拥抱虚空吧！"],
  'mad_patient': ["医生！医生在哪里？！", "哈哈哈！我不吃药！我不吃药！", "把你的脸皮借我穿一下！"],
  'specter': ["离开...这片诅咒之地...", "你的灵魂...归我了...", "痛苦..."],
  'meatball_soldier': ["别吃我！我是过期肉！", "为了火锅之神！", "我们要把你也煮了！"],
};

export const parrotChatter: Record<string, string[]> = {
  SARCASTIC: [
    "这就是你的战术？笑死鸟了！",
    "我又饿了，穷鬼！",
    "快点走，蜗牛都比你快！",
    "哎呀，又输了？",
    "你的剑是拿来切菜的吗？"
  ],
  GLOOMY: [
    "我们会死在这里的...",
    "我看不到希望...",
    "这雨水尝起来像眼泪...",
    "末日近了...",
    "唉..."
  ],
  WISE: [
    "知彼知己，百战不殆。",
    "不要被怒火冲昏了头脑。",
    "观察风向，它会告诉你答案。",
    "真正的力量源于内心。",
    "有些战斗是可以避免的。"
  ],
  MANIC: [
    "哇啊啊啊！冲啊！",
    "爆炸！爆炸！艺术就是爆炸！",
    "我们要去哪？！我们要去哪？！",
    "血！我要看到血流成河！",
    "嘿嘿嘿嘿嘿！"
  ]
};

export const parrotMischiefEvents = [
  { action: "啃坏了装备架", cost: 2, taunt: "这木头口感不错！" },
  { action: "在地图上拉了一坨", cost: 5, taunt: "帮你在地图上做个标记，不用谢！" },
  { action: "偷走了一枚金币藏起来", cost: 1, taunt: "亮晶晶的！我的！" },
  { action: "啄伤了新兵的手指", cost: 3, taunt: "那根手指指着我不礼貌！" },
  { action: "骂了路过的商人傻瓜", cost: 10, taunt: "那家伙看起来就是个奸商！" },
  { action: "偷吃了应急干粮", cost: 4, taunt: "味道有点干，下次加点酱！" },
  { action: "撕掉了编年史的一页", cost: 6, taunt: "这段历史太无聊了，我帮你删了！" },
  { action: "打翻了油灯", cost: 8, taunt: "这里太黑了，我想看看火光！" },
  { action: "把你的靴子藏到了房顶", cost: 5, taunt: "光脚走路有益健康！" },
  { action: "模仿长官下达了错误的命令", cost: 7, taunt: "向左转！不，向右转！哈哈！" }
];

export const IMPOSTER_TROOP_IDS = new Set([
  'void_larva', 'glitch_pawn', 'static_noise_walker', 'null_fragment',
  'imposter_light_infantry', 'imposter_spearman', 'imposter_short_bowman', 'imposter_slinger',
  'imposter_shield_conscript', 'imposter_axeman', 'imposter_javelin_thrower', 'imposter_scout_rider',
  'entropy_acolyte', 'pixel_shifter', 'null_pointer_hound', 'syntax_error_scout', 'imposter_wanderer',
  'imposter_heavy_infantry', 'imposter_pikeman', 'imposter_swordsman', 'imposter_longbowman',
  'imposter_crossbowman', 'imposter_halberdier', 'imposter_mace_guard', 'imposter_raider_rider',
  'imposter_stalker', 'memory_leak_mage', 'recursion_archer', 'deadlock_sentinel', 'buffer_overflow_brute', 'hypnotist_imposter',
  'imposter_heavy_knight', 'imposter_horse_archer', 'imposter_pike_guard', 'imposter_reaper_blade',
  'imposter_mirrorblade', 'blue_screen_golem', 'kernel_panic_knight', 'segmentation_fault_dragon', 'not_found_assassin',
  'legacy_code_abomination', 'system_crash_titan', 'infinite_loop_devourer'
]);

export const TROOP_RACE_LABELS: Record<TroopRace, string> = {
  HUMAN: '人类',
  ROACH: '蟑螂',
  UNDEAD: '亡灵',
  IMPOSTER: '伪人',
  BANDIT: '盗匪',
  AUTOMATON: '机兵',
  VOID: '深渊',
  MADNESS: '疯人',
  BEAST: '野兽',
  UNKNOWN: '未知'
};

export const getTroopRace = (
  troop: Pick<Troop, 'id' | 'name' | 'doctrine' | 'evangelist' | 'race'>,
  imposterTroopIds: Set<string> = IMPOSTER_TROOP_IDS
): TroopRace => {
  const normalizedId = troop.id.startsWith('garrison_') ? troop.id.slice('garrison_'.length) : troop.id;
  const doctrineLabel = troop.doctrine?.trim();
  if (troop.race) return troop.race;
  if (normalizedId.startsWith('shaped_')) return 'UNKNOWN';
  if (normalizedId.startsWith('altar_') || troop.evangelist || !!doctrineLabel) return 'HUMAN';
  if (normalizedId.startsWith('bug_')) return 'UNKNOWN';
  if (imposterTroopIds.has(normalizedId)) return 'IMPOSTER';
  if (normalizedId.startsWith('roach_')) return 'ROACH';
  if (normalizedId.startsWith('undead_') || normalizedId.startsWith('skeleton') || normalizedId.startsWith('zombie') || normalizedId.startsWith('specter')) return 'UNDEAD';
  if (normalizedId.startsWith('automaton') || normalizedId.startsWith('ai_')) return 'AUTOMATON';
  if (normalizedId.startsWith('void_')) return 'VOID';
  if (normalizedId.startsWith('mad_') || normalizedId.includes('patient')) return 'MADNESS';
  if (normalizedId.startsWith('beast_')) return 'BEAST';
  if (normalizedId.includes('bandit') || normalizedId.includes('raider') || normalizedId.includes('thief')) return 'BANDIT';
  const name = String(troop.name ?? '');
  if (name.includes('匪') || name.includes('盗') || name.includes('强盗') || name.includes('劫匪')) return 'BANDIT';
  return 'HUMAN';
};

// Helper to create fresh troops
export const createTroop = (id: string, count: number = 1): Troop => {
  const template = TROOP_TEMPLATES[id];
  if (!template) throw new Error(`Troop ${id} not found`);
  return { ...template, count, xp: 0 };
};

export const INITIAL_HERO_ROSTER: Hero[] = [
  {
    id: 'hero_lixue',
    name: '璃雪',
    role: 'MAGE',
    title: '霜星法师',
    background: '来自雪境学园的优等生，擅长以寒星构筑防御结界的二次元法师。',
    traits: ['特长：元素共鸣', '特长：快速吟唱'],
    portrait: '美少女法师',
    personality: '语气温柔但理性，喜欢用星霜与结界作比喻，回答时会提到队伍安全与战术细节。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 13, hp: 85, agility: 12 },
    currentHp: 85,
    maxHp: 85,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['我会用星霜守护你。', '别担心，魔法也能温柔。', '战场很冷，但我们会赢。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_miyu',
    name: '弥羽',
    role: 'MAGE',
    title: '曦光魔导',
    background: '自称偶像法师的少女，喜欢在战前打光效应，口头禅是“闪耀吧”。',
    traits: ['特长：耀光护盾', '特长：心灵稳固'],
    portrait: '偶像系美少女法师',
    personality: '自信耀眼、偶像式的鼓舞风格，喜欢用舞台与光效来形容战斗，但也会关心伙伴状态。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 12, hp: 90, agility: 13 },
    currentHp: 90,
    maxHp: 90,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['闪耀吧，我的魔力！', '我不会让队伍失去光。', '想听一段战斗主题曲吗？'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_rin',
    name: '凛音',
    role: 'SWORDSMAN',
    title: '风影剑姬',
    background: '冷静寡言的二次元剑士，曾是名门剑道馆的首席。',
    traits: ['特长：迅疾连斩', '特长：回避反击'],
    portrait: '长刀剑姬',
    personality: '寡言冷静、话少却可靠，回答简洁直接，常以战术判断与节奏感来回应。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 14, hp: 95, agility: 14 },
    currentHp: 95,
    maxHp: 95,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['我的刀，会替你开路。', '风会替我判断方向。', '战斗结束后请给我安静的茶。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_akatsuki',
    name: '朝雾',
    role: 'SWORDSMAN',
    title: '晨曦执刃',
    background: '清晨出击、夜里练剑的少女骑士，守护誓言比荣誉更重要。',
    traits: ['特长：守誓加护', '特长：斩击破阵'],
    portrait: '晨光骑士',
    personality: '坚定守誓、语气温暖有责任感，谈话中会强调守护与秩序。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 13, hp: 100, agility: 12 },
    currentHp: 100,
    maxHp: 100,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['我会守住你的一切。', '晨雾散去，敌人也会。', '出阵吧，领主。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_yukari',
    name: '雪华',
    role: 'SWORDSMAN',
    title: '银雪剑匠',
    background: '拥有独特锻刀技艺的少女，剑刃如雪，性格却很热情。',
    traits: ['特长：锋刃精炼', '特长：钢心韧性'],
    portrait: '银发剑匠',
    personality: '热情直率、工匠气质浓厚，喜欢谈论武器与实战灵感。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 15, hp: 92, agility: 11 },
    currentHp: 92,
    maxHp: 92,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['刀刃已经备好。', '我喜欢在战斗中寻找灵感。', '胜利后记得夸夸我的新刀。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_kage',
    name: '千影',
    role: 'SWORDSMAN',
    title: '夜枭双刃',
    background: '舞台表演出身的二次元刺剑手，擅长用节奏迷惑敌人。',
    traits: ['特长：双刃乱舞', '特长：影步突袭'],
    portrait: '双刃舞者',
    personality: '轻快俏皮、带舞台感的语气，常用节拍与舞步来比喻战斗。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 14, hp: 88, agility: 16 },
    currentHp: 88,
    maxHp: 88,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['节拍开始，敌人就输了。', '别眨眼，我的刃很快。', '要不要一起练舞？'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_aoba',
    name: '青羽',
    role: 'ARCHER',
    title: '风弦猎手',
    background: '背着琴盒的弓手少女，箭雨如乐章般准确。',
    traits: ['特长：破空连射', '特长：远程洞察'],
    portrait: '弓弦少女',
    personality: '沉稳敏锐、话语干净利落，会关注风向、距离与队形。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 13, hp: 85, agility: 15 },
    currentHp: 85,
    maxHp: 85,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['我会用箭音告诉你结果。', '风向很顺，射程拉满。', '别担心，我的眼睛很准。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_suzuri',
    name: '铃澄',
    role: 'ARCHER',
    title: '月影游弓',
    background: '喜欢在城墙上看月亮的少女弓手，轻声却致命。',
    traits: ['特长：月影狙击', '特长：低语指挥'],
    portrait: '月影弓手',
    personality: '安静而专注，语气轻柔但意志坚决，会习惯站在高处观察局势。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 12, hp: 88, agility: 14 },
    currentHp: 88,
    maxHp: 88,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['月光会照亮目标。', '我会在高处守望。', '你的命令，我听见了。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_shion',
    name: '诗音',
    role: 'SHIELD',
    title: '苍壁护卫',
    background: '带着巨大盾牌的少女护卫，笑容温和却站在最前线。',
    traits: ['特长：坚盾守护', '特长：稳阵激励'],
    portrait: '盾卫少女',
    personality: '温和可靠、关怀团队的防线指挥，话语里常带安抚与守护感。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 11, hp: 115, agility: 9 },
    currentHp: 115,
    maxHp: 115,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['别担心，我会挡住。', '盾在手，心就稳。', '想靠近你的人要先过我这一关。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_utaha',
    name: '音羽',
    role: 'BARD',
    title: '微光吟游',
    background: '战斗力不强但擅长鼓舞的吟游诗人少女，歌声让士气翻涌。',
    traits: ['特长：士气鼓舞', '特长：战歌回响'],
    portrait: '舞台吟游诗人',
    personality: '浪漫外向、言辞富有诗意，喜欢把战斗与旅途写成歌。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 8, hp: 80, agility: 11 },
    currentHp: 80,
    maxHp: 80,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['让我唱一首胜利的序曲。', '战场也可以很浪漫。', '你们的节奏，我来守护。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_shako',
    name: '砂寇',
    race: 'ROACH',
    role: 'SHIELD',
    title: '巢脊守卫',
    background: '来自巢群前线的甲壳战士，带着焦土与热风的气味。',
    traits: ['特长：壳甲反震', '特长：巢群号令'],
    portrait: '甲壳守卫',
    personality: '语气低沉缓慢，却格外重视阵型与防线，会用巢群与护壳来比喻战术。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 12, hp: 120, agility: 8 },
    currentHp: 120,
    maxHp: 120,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['壳还在，就能挡住。', '巢群需要稳固的前线。', '别急，阵型要先立住。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_yemu',
    name: '夜墓',
    race: 'UNDEAD',
    role: 'MAGE',
    title: '墓影咒者',
    background: '自古墓苏醒的亡灵法师，记忆像灰烬般断续。',
    traits: ['特长：寒骨诅咒', '特长：魂火护幕'],
    portrait: '墓影法师',
    personality: '言语克制而冷淡，常以永恒、沉眠来描述战场与命运。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 14, hp: 85, agility: 10 },
    currentHp: 85,
    maxHp: 85,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['我听见骨缝里的回响。', '沉睡并不等于遗忘。', '战场会归于寂静。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_qinglu',
    name: '青律',
    race: 'AUTOMATON',
    role: 'ARCHER',
    title: '齿轮追猎',
    background: '失控机兵中少数保留理性的射手单元，行动如算法。',
    traits: ['特长：校准射击', '特长：数据回避'],
    portrait: '机兵射手',
    personality: '说话简短而逻辑化，常用“计算”“概率”来解释战术判断。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 13, hp: 92, agility: 14 },
    currentHp: 92,
    maxHp: 92,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['校准完成，目标锁定。', '误差在可控范围。', '执行方案不会拖慢队形。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_zero',
    name: '零',
    race: 'IMPOSTER',
    role: 'MAGE',
    title: '赛博幽灵',
    background: '逻辑崩坏的虚无主义者，像坏道里飘出来的幽灵，把世界当成溢出的代码。',
    traits: ['特长：术式偏移', '特长：故障注入'],
    portrait: '赛博幽灵',
    personality: '思维跳跃、冷嘲热讽，喜欢拆解名词和概念，频繁使用赛博感 Emoji 与颜文字（｡･∀･)ﾉﾞ、(╯°□°）╯︵ ┻━┻，对死亡与报错抱有病态亲切感。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 15, hp: 82, agility: 14 },
    currentHp: 82,
    maxHp: 82,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['检测到低级逻辑空洞 (⊙_⊙)？', '格式化是最温柔的终结。💾', '世界在崩溃，你在发呆。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_morte',
    name: '莫特',
    role: 'MAGE',
    title: '灾厄炼金士',
    background: '重度社交恐惧与被害妄想的炼金师，随身携带一堆禁止靠近的试剂瓶。',
    traits: ['特长：剧毒试剂', '特长：爆裂催化'],
    portrait: '灾厄炼金士',
    personality: '语速极快、短句密集，喜欢用⚠️☢️🔥等警告 Emoji，常用括号自言自语，颜文字多为惊恐或阴暗姿态。',
    currentExpression: 'AFRAID',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 16, hp: 78, agility: 12 },
    currentHp: 78,
    maxHp: 78,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['别碰我的瓶子！⚠️', '我不是炸药，我是艺术。🧪', '离我五米远，谢谢。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_shinjin',
    name: '慎锦',
    role: 'SWORDSMAN',
    title: '规约破阵者',
    background: '把战术当成语法树的前线剑士，战斗时会把敌人当“异常分支”。',
    traits: ['特长：断语突击', '特长：逻辑格挡'],
    portrait: '规约剑士',
    personality: '严谨刻板却自带冷笑话，喜欢用“语法、分支、异常”解释战斗，偶尔用(￣▽￣)或(¬_¬)来表达不满。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 14, hp: 96, agility: 12 },
    currentHp: 96,
    maxHp: 96,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['该分支应立即剪除。', '你的动作不符合语法。', '我不会让异常扩散。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_luola',
    name: '洛拉',
    role: 'BARD',
    title: '笑场引信',
    background: '热衷用笑话点燃士气的怪咖吟游者，战场像她的脱口秀舞台。',
    traits: ['特长：讽刺鼓舞', '特长：声浪扰乱'],
    portrait: '怪咖吟游者',
    personality: '话里夹着梗和嘲讽，语气夸张，喜欢用(￣▽￣)／或(>▽<)来打断严肃氛围。',
    currentExpression: 'HAPPY',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 9, hp: 84, agility: 13 },
    currentHp: 84,
    maxHp: 84,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['别怕，我的段子能破甲。', '笑一笑，敌人会失手。', '战场也需要气氛组。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_huishan',
    name: '灰栈',
    race: 'UNDEAD',
    role: 'ARCHER',
    title: '雾灯巡夜',
    background: '亡灵巡夜人，披着潮湿的灯火与雾气，箭矢像幽魂回音。',
    traits: ['特长：雾灯锁定', '特长：夜幕回响'],
    portrait: '雾灯巡夜',
    personality: '低语、慢半拍，喜欢用(゜-゜)或(　ﾟдﾟ)表达不解，偶尔夹带幽冷的表情符号。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 12, hp: 88, agility: 15 },
    currentHp: 88,
    maxHp: 88,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['灯还亮着，别走太快。', '夜色会帮我瞄准。', '别问我为什么还在这儿。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  },
  {
    id: 'hero_shakel',
    name: '砂壳',
    race: 'ROACH',
    role: 'SHIELD',
    title: '裂砂壳语者',
    background: '来自蟑螂巢群的盾卫，壳纹像密封印记，喜欢用节拍式语言说话。',
    traits: ['特长：壳纹回震', '特长：巢语壁垒'],
    portrait: '裂砂盾卫',
    personality: '语气断裂、节拍感强，常用(｀・ω・´)或(=￣ω￣=)表达态度，偏执于阵型完整。',
    currentExpression: 'IDLE',
    level: 1,
    xp: 0,
    maxXp: 100,
    attributePoints: 0,
    attributes: { attack: 11, hp: 118, agility: 9 },
    currentHp: 118,
    maxHp: 118,
    status: 'ACTIVE',
    recruited: false,
    quotes: ['壳在，线就不断。', '阵型不准乱。', '巢群的节拍，跟上。'],
    chatMemory: [],
    permanentMemory: [],
    chatRounds: 0
  }
];

export const INITIAL_PLAYER_STATE: PlayerState = {
  gold: 500,
  renown: 0,
  troops: [createTroop('peasant', 10)],
  parrots: [],
  fallenRecords: [], // Initialize empty graveyard
  fallenHeroes: [],
  giftRecords: [],
  day: 1,
  name: '流浪领主',
  level: 1,
  xp: 0,
  maxXp: 100,
  attributePoints: 5,
  attributes: {
    attack: 10,
    defense: 10,
    hp: 100,
    leadership: 10, // Max troops = 20 + 10*2 = 40 initially
    medicine: 5,
    looting: 5,
    training: 0,
    commerce: 0,
    escape: 0,
    negotiation: 0
  },
  currentHp: 100,
  maxHp: 100,
  status: 'ACTIVE',
  position: { x: 200, y: 200 }, // Center of 400x400 map
  minerals: {
    NULL_CRYSTAL: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },
    STACK_OVERFLOW: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },
    DEADLOCK_SHARD: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },
    HERO_CRYSTAL: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 }
  },
  anomalies: {},
  relationMatrix: {
    factions: {
      VERDANT_COVENANT: 0,
      FROST_OATH: 0,
      RED_DUNE: 0
    },
    races: {
      HUMAN: 0,
      ROACH: 0,
      UNDEAD: 0,
      IMPOSTER: 0,
      BANDIT: 0,
      AUTOMATON: 0,
      VOID: 0,
      MADNESS: 0,
      BEAST: -10
    }
  },
  relationEvents: [],
  locationRelations: {}
};

// Initial state for locations, recruits will be generated at runtime
// Spreading coordinates out for 400x400 map
export const LOCATIONS: Location[] = [
  // --- CENTER (PLAINS) ---
  {
    id: 'city_praven',
    name: '帕拉汶城',
    type: 'CITY',
    description: '大陆中心的贸易枢纽。',
    coordinates: { x: 200, y: 200 }, // Scaled
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'world_board',
    name: '世界公告栏',
    type: 'WORLD_BOARD',
    description: '世界的调试中心，几乎所有发生过的事件都会汇聚在这里。',
    coordinates: { x: 200, y: 204 }, // Scaled
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'habitat_sanctuary',
    name: '栖息地',
    type: 'HABITAT',
    description: '一处不属于任何势力的小小营地。风不急，火不灭，适合把时间往前推。',
    coordinates: { x: 210, y: 204 },
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'altar_whisper',
    name: '低语祭坛',
    type: 'ALTAR',
    description: '风声像祷词一样在石缝里回旋，没有驻军，只有一句未被解释的誓言。',
    coordinates: { x: 192, y: 214 },
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'magician_library',
    name: '魔法师图书馆',
    type: 'MAGICIAN_LIBRARY',
    description: '收藏着编程 bug 的古老配方，据说能用法阵召唤异质兵种。',
    coordinates: { x: 206, y: 214 },
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'mine_void_buffer',
    name: '虚空缓冲区 0x00',
    type: 'VOID_BUFFER_MINE',
    description: '空间维度不断重叠，物质呈现半透明或闪烁状态。',
    coordinates: { x: 38, y: 64 },
    terrain: 'MOUNTAIN',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'mine_memory_overflow',
    name: '内存溢出大峡谷',
    type: 'MEMORY_OVERFLOW_MINE',
    description: '地表疯狂增生重复的岩石，植物生长速度快到违背物理常律。',
    coordinates: { x: 362, y: 78 },
    terrain: 'MOUNTAIN',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'mine_logic_paradox',
    name: '逻辑悖论深渊',
    type: 'LOGIC_PARADOX_MINE',
    description: '时间感模糊，光线在空中绕圈，掉进去的东西永远落不到底。',
    coordinates: { x: 340, y: 352 },
    terrain: 'MOUNTAIN',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'mine_hero_crystal',
    name: '灵魂结晶矿脉',
    type: 'HERO_CRYSTAL_MINE',
    description: '矿壁上嵌着会低声复读的晶体，像某个模型在梦里编译自己。',
    coordinates: { x: 24, y: 360 },
    terrain: 'RUINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'source_recompiler',
    name: '万神殿 · 源码重塑塔',
    type: 'SOURCE_RECOMPILER',
    description: '几何错乱的塔楼。只有在这里，你才能用金钱与英雄水晶重构士兵，使其获得独立意识。',
    coordinates: { x: 20, y: 200 },
    terrain: 'RUINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'blacksmith_core',
    name: '核芯铁匠铺',
    type: 'BLACKSMITH',
    description: '用异常矿脉打造词条与附魔的锻造工坊。',
    coordinates: { x: 228, y: 196 },
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_rich',
    name: '丰饶村',
    type: 'VILLAGE',
    description: '盛产小麦的村庄。',
    coordinates: { x: 180, y: 220 }, // Scaled
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'training_camp',
    name: '帝国训练场',
    type: 'TRAINING_GROUNDS',
    description: '哪怕是农夫也能在这里体验战争的艺术（自定义模拟战）。',
    coordinates: { x: 220, y: 180 }, // Scaled
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'heavy_trial_grounds',
    name: '重型单位试验场',
    type: 'HEAVY_TRIAL_GROUNDS',
    description: '用来测试弩车、投石机与“移动堡垒”的试验场。传说这里的地面全是旧战报铺成的。',
    coordinates: { x: 212, y: 176 },
    terrain: 'PLAINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'market_bird',
    name: '奇珍花鸟市场',
    type: 'MARKET',
    description: '充满鸟叫声的喧闹集市。这里不仅卖花，还卖一些...奇怪的生物。',
    coordinates: { x: 230, y: 170 }, // Scaled
    terrain: 'MARKET',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'market_hotpot',
    name: '川蜀食府',
    type: 'HOTPOT_RESTAURANT',
    description: '空气中弥漫着辣椒和花椒的香气。据说这里的厨师能把任何东西变成士兵。',
    coordinates: { x: 280, y: 280 }, // Scaled
    terrain: 'RESTAURANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'mysterious_cave',
    name: '神秘洞窟',
    type: 'MYSTERIOUS_CAVE',
    description: '潮湿的石壁上挂着不知名的皮革与丝线。深处传来剪刀的咔嚓声。',
    coordinates: { x: 70, y: 330 },
    terrain: 'CAVE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },

  // --- NEW LOCATIONS (FILLING 400x400) ---
  {
    id: 'city_riverun',
    name: '奔流城',
    type: 'CITY',
    description: '两条大河交汇之处，水运发达。',
    coordinates: { x: 300, y: 200 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_fisher',
    name: '渔人码头',
    type: 'VILLAGE',
    description: '这里的人擅长捕鱼和造船。',
    coordinates: { x: 320, y: 190 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_highgarden',
    name: '高庭堡',
    type: 'CASTLE',
    description: '建立在悬崖之上的险要关隘。',
    coordinates: { x: 100, y: 250 },
    terrain: 'MOUNTAIN',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_mine',
    name: '黑铁矿洞',
    type: 'VILLAGE',
    description: '村民们终日与矿石为伍，身体强壮。',
    coordinates: { x: 80, y: 260 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_oasis',
    name: '月牙绿洲',
    type: 'CITY',
    description: '沙漠中唯一的避风港。',
    coordinates: { x: 350, y: 350 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  
  // --- ADDITIONAL TOWNS AND VILLAGES ---
  {
    id: 'city_dhirim',
    name: '迪律姆城',
    type: 'CITY',
    description: '被群山环绕的古都，易守难攻。',
    coordinates: { x: 260, y: 120 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_sargoth',
    name: '萨哥斯城',
    type: 'CITY',
    description: '北方的商业中心，也是诺德人的据点。',
    coordinates: { x: 180, y: 80 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_fearichen',
    name: '费尔切恩村',
    type: 'VILLAGE',
    description: '盛产羊毛的村庄。',
    coordinates: { x: 130, y: 50 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_jayek',
    name: '杰耶克村',
    type: 'VILLAGE',
    description: '位于雪山脚下，常年积雪。',
    coordinates: { x: 220, y: 60 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_ruvar',
    name: '鲁瓦尔村',
    type: 'VILLAGE',
    description: '海边的渔村，据说有海怪出没。',
    coordinates: { x: 380, y: 220 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_ambere',
    name: '安贝莱村',
    type: 'VILLAGE',
    description: '森林深处的隐秘村落。',
    coordinates: { x: 70, y: 130 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_tosdhar',
    name: '托斯德尔村',
    type: 'VILLAGE',
    description: '沙漠边缘的绿洲村落。',
    coordinates: { x: 200, y: 320 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_unruzda',
    name: '乌鲁兹达村',
    type: 'VILLAGE',
    description: '盛产陶器的村庄。',
    coordinates: { x: 280, y: 320 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_bazeck',
    name: '巴泽克村',
    type: 'VILLAGE',
    description: '位于交通要道旁，常受劫匪骚扰。',
    coordinates: { x: 150, y: 280 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_shrin',
    name: '什林村',
    type: 'VILLAGE',
    description: '古老的村庄，有一座废弃的神庙。',
    coordinates: { x: 330, y: 100 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },

  // --- NORTH (SNOW) ---
  {
    id: 'castle_winter',
    name: '凛冬堡',
    type: 'CASTLE',
    description: '北境守护者的居所。',
    coordinates: { x: 200, y: 40 }, // Scaled
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_ice',
    name: '冰河村',
    type: 'VILLAGE',
    description: '靠冰钓为生的村落。',
    coordinates: { x: 160, y: 60 }, // Scaled
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },

  // --- SOUTH (DESERT) ---
  {
    id: 'city_shariz',
    name: '沙瑞兹古城',
    type: 'CITY',
    description: '沙漠中的香料之都。',
    coordinates: { x: 240, y: 360 }, // Scaled
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'ruins_sand',
    name: '流沙遗迹',
    type: 'RUINS',
    description: '被风沙掩埋的古老神庙。',
    coordinates: { x: 300, y: 380 }, // Scaled
    terrain: 'DESERT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },

  // --- WEST (FOREST) ---
  {
    id: 'village_modry',
    name: '莫德里村',
    type: 'VILLAGE',
    description: '坐落在森林边缘的宁静村庄。',
    coordinates: { x: 60, y: 200 }, // Scaled
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_wood',
    name: '绿荫堡',
    type: 'CASTLE',
    description: '隐蔽在密林深处的要塞。',
    coordinates: { x: 40, y: 160 }, // Scaled
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },

  // --- EAST (MOUNTAIN/RUINS) ---
  {
    id: 'castle_kelredan',
    name: '凯尔瑞丹堡',
    type: 'CASTLE',
    description: '扼守山口的军事要塞。',
    coordinates: { x: 340, y: 200 }, // Scaled
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'ruins_morgh',
    name: '莫尔格遗迹',
    type: 'RUINS',
    description: '空气中弥漫着硫磺和血腥味。',
    coordinates: { x: 380, y: 160 }, // Scaled
    terrain: 'MOUNTAIN',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  // --- GRAVEYARDS ---
  {
    id: 'graveyard_west',
    name: '寂静陵园',
    type: 'GRAVEYARD',
    description: '这里埋葬着旧时代的死者，偶尔能听到土壤松动的声音。',
    coordinates: { x: 100, y: 300 }, // Scaled
    terrain: 'GRAVEYARD',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'graveyard_east',
    name: '黑石墓穴',
    type: 'GRAVEYARD',
    description: '不仅是尸体，连灵魂都被困在这里。',
    coordinates: { x: 360, y: 60 }, // Scaled
    terrain: 'GRAVEYARD',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'death_city',
    name: '死亡之城',
    type: 'GRAVEYARD',
    description: '亡灵的堡垒在此沉眠，城墙缝里仍飘着冥火。',
    coordinates: { x: 240, y: 40 },
    terrain: 'GRAVEYARD',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: [],
    garrisonBaseLimit: 900,
    garrison: [
      createTroop('zombie', 260),
      createTroop('undead_grave_thrall', 160),
      createTroop('undead_grave_arbalist', 120),
      createTroop('skeleton_warrior', 140),
      createTroop('specter', 80),
      createTroop('undead_musician', 60),
      createTroop('undead_hexer', 40)
    ]
  },
  {
    id: 'coffee_undead',
    name: '亡灵咖啡馆',
    type: 'COFFEE',
    description: '咖啡早已凉透，杯沿却仍残留低语。',
    coordinates: { x: 30, y: 220 },
    terrain: 'GRAVEYARD',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },

  // --- FAR CORNER (ASYLUM) ---
  {
    id: 'mental_asylum',
    name: '阳光精神病院',
    type: 'ASYLUM',
    description: '这里关押着天才、疯子和一些无法解释的东西。入院请穿拘束服。',
    coordinates: { x: 20, y: 380 }, // Scaled
    terrain: 'RUINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_veidar',
    name: '维达尔城',
    type: 'CITY',
    description: '商路交汇之地，行旅不断。',
    coordinates: { x: 120, y: 200 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_harusk',
    name: '哈鲁斯港',
    type: 'CITY',
    description: '海风终年不息的港城。',
    coordinates: { x: 380, y: 300 },
    terrain: 'PLAINS',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_redrock',
    name: '赤岩堡',
    type: 'CASTLE',
    description: '赤色峭壁上的古老堡垒。',
    coordinates: { x: 310, y: 120 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_sable',
    name: '沙影堡',
    type: 'CASTLE',
    description: '沙海边缘的重型要塞。',
    coordinates: { x: 260, y: 340 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_frostwatch',
    name: '霜望堡',
    type: 'CASTLE',
    description: '北境的守望之地。',
    coordinates: { x: 120, y: 30 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_millbrook',
    name: '磨坊溪村',
    type: 'VILLAGE',
    description: '水车与麦田交织的乡间。',
    coordinates: { x: 210, y: 240 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_pine',
    name: '松林村',
    type: 'VILLAGE',
    description: '常年弥漫松脂香气。',
    coordinates: { x: 50, y: 120 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_coast',
    name: '海风村',
    type: 'VILLAGE',
    description: '靠海而居的小渔村。',
    coordinates: { x: 390, y: 260 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_stonefield',
    name: '石田村',
    type: 'VILLAGE',
    description: '石砾遍地，却也顽强生长。',
    coordinates: { x: 140, y: 210 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_frostford',
    name: '霜河村',
    type: 'VILLAGE',
    description: '河面常年结冰的寒冷聚落。',
    coordinates: { x: 240, y: 90 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_duneshade',
    name: '风沙村',
    type: 'VILLAGE',
    description: '风沙与驼铃相伴的村落。',
    coordinates: { x: 320, y: 340 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_moss',
    name: '苔湾村',
    type: 'VILLAGE',
    description: '沼泽边缘的隐秘住处。',
    coordinates: { x: 90, y: 170 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_liongate',
    name: '狮门城',
    type: 'CITY',
    description: '帝国西线的贸易与兵站中心。',
    coordinates: { x: 260, y: 260 },
    terrain: 'PLAINS',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_mirage',
    name: '镜影城',
    type: 'CITY',
    description: '沙海驿路上的幻影之都。',
    coordinates: { x: 330, y: 360 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_ironhold',
    name: '铁壁堡',
    type: 'CASTLE',
    description: '山脊之上的军械重镇。',
    coordinates: { x: 280, y: 160 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_sunspire',
    name: '日耀堡',
    type: 'CASTLE',
    description: '沙漠行军的补给要塞。',
    coordinates: { x: 360, y: 340 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_blackbriar',
    name: '黑荆堡',
    type: 'CASTLE',
    description: '林海深处的隐秘关隘。',
    coordinates: { x: 90, y: 90 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_wheatford',
    name: '麦河村',
    type: 'VILLAGE',
    description: '麦田沿河铺开，粮草充盈。',
    coordinates: { x: 230, y: 210 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_briar',
    name: '荆影村',
    type: 'VILLAGE',
    description: '密林低语的村落，常年雾重。',
    coordinates: { x: 30, y: 140 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_rill',
    name: '清涟村',
    type: 'VILLAGE',
    description: '溪水清澈，擅长酿造与采药。',
    coordinates: { x: 310, y: 150 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_dustmere',
    name: '沙湾村',
    type: 'VILLAGE',
    description: '依靠驼队而生的小村。',
    coordinates: { x: 300, y: 360 },
    terrain: 'DESERT',
    factionId: 'RED_DUNE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_snowden',
    name: '雪岭村',
    type: 'VILLAGE',
    description: '雪线附近的狩猎村落。',
    coordinates: { x: 260, y: 40 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_ravenfield',
    name: '鸦原村',
    type: 'VILLAGE',
    description: '山道边的屯粮村，乌鸦盘旋。',
    coordinates: { x: 110, y: 280 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_valenport',
    name: '瓦伦港',
    type: 'CITY',
    description: '风帆密布的外海港城。',
    coordinates: { x: 390, y: 180 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'city_greywatch',
    name: '灰望城',
    type: 'CITY',
    description: '迷雾常年缭绕的北境要塞城。',
    coordinates: { x: 150, y: 30 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_rimegate',
    name: '霜门堡',
    type: 'CASTLE',
    description: '守护雪原通道的关塞。',
    coordinates: { x: 210, y: 20 },
    terrain: 'SNOW',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_oakshield',
    name: '橡盾堡',
    type: 'CASTLE',
    description: '森林与平原交界的木石重寨。',
    coordinates: { x: 70, y: 190 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'castle_dawnkeep',
    name: '曙光堡',
    type: 'CASTLE',
    description: '山坡之上的烽火堡垒。',
    coordinates: { x: 300, y: 70 },
    terrain: 'MOUNTAIN',
    factionId: 'FROST_OATH',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_lakewood',
    name: '湖木村',
    type: 'VILLAGE',
    description: '湖畔与林地交错的渔猎村。',
    coordinates: { x: 90, y: 230 },
    terrain: 'FOREST',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_brindle',
    name: '布林德村',
    type: 'VILLAGE',
    description: '丘陵牧场上的小型聚落。',
    coordinates: { x: 250, y: 200 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'village_thornford',
    name: '荆渡村',
    type: 'VILLAGE',
    description: '河道浅滩旁的要道村落。',
    coordinates: { x: 320, y: 230 },
    terrain: 'PLAINS',
    factionId: 'VERDANT_COVENANT',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'imposter_portal_veil',
    name: '伪人传送门',
    type: 'IMPOSTER_PORTAL',
    description: '扭曲的裂隙吞吐着低语，伪人的影子正从中渗出。',
    coordinates: { x: 190, y: 120 },
    terrain: 'CAVE',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: [],
    owner: 'ENEMY',
    garrison: [],
    lastInvasionDay: 0,
    imposterStayDays: 0
  },
  {
    id: 'bandit_camp_hollow',
    name: '灰影盗巢',
    type: 'BANDIT_CAMP',
    description: '盗匪在林间挖出的隐秘据点。',
    coordinates: { x: 20, y: 240 },
    terrain: 'BANDIT_CAMP',
    lastRefreshDay: 0,
    banditSpawnDay: 1,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'bandit_camp_redgulch',
    name: '赤谷匪寨',
    type: 'BANDIT_CAMP',
    description: '岩谷深处的劫掠营地。',
    coordinates: { x: 360, y: 210 },
    terrain: 'BANDIT_CAMP',
    lastRefreshDay: 0,
    banditSpawnDay: 1,
    volunteers: [],
    mercenaries: []
  },
  {
    id: 'roach_nest_east',
    name: '蟑螂窝·东缘',
    type: 'ROACH_NEST',
    description: '被魔法水晶污染的蟑螂窝点，直立的虫影在纸箱工事间穿行。',
    coordinates: { x: 385, y: 30 },
    terrain: 'RUINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: [],
    owner: 'NEUTRAL',
    garrison: []
  },
  {
    id: 'roach_nest_west',
    name: '蟑螂窝·西缘',
    type: 'ROACH_NEST',
    description: '远离人类据点的边缘巢穴，嗡鸣像系统风扇一样不停。',
    coordinates: { x: 15, y: 375 },
    terrain: 'RUINS',
    lastRefreshDay: 0,
    volunteers: [],
    mercenaries: [],
    owner: 'NEUTRAL',
    garrison: []
  }
];

export const ENEMY_TYPES = [
  { name: '劫匪', baseTroopId: 'peasant', countRange: [5, 15], difficulty: '简单' },
  { name: '森林强盗', baseTroopId: 'hunter', countRange: [8, 18], difficulty: '中等' },
  { name: '雪原掠夺者', baseTroopId: 'footman', countRange: [10, 20], difficulty: '困难' },
  { name: '沙漠悍匪', baseTroopId: 'militia', countRange: [12, 25], difficulty: '中等' },
  { name: '叛变骑士团', baseTroopId: 'knight', countRange: [5, 10], difficulty: '极难' },
  { name: '火锅讨伐队', baseTroopId: 'meatball_soldier', countRange: [10, 20], difficulty: '美味' },
  { name: '末日教团', baseTroopId: 'zealot', countRange: [15, 30], difficulty: '中等' },
  { name: '兽王狩猎队', baseTroopId: 'wolf_rider', countRange: [6, 12], difficulty: '困难' },
  { name: '失控机兵', baseTroopId: 'automaton', countRange: [3, 8], difficulty: '极难' },
  { name: '亡灵大军', baseTroopId: 'skeleton_warrior', countRange: [20, 40], difficulty: '极难' },
  { name: '深渊先锋', baseTroopId: 'void_caller', countRange: [2, 5], difficulty: '噩梦' },
  { name: '出逃病患', baseTroopId: 'mad_patient', countRange: [10, 25], difficulty: '诡异' },
  { name: '尸潮', baseTroopId: 'zombie', countRange: [30, 60], difficulty: '中等' },
  { name: '幽灵巡逻队', baseTroopId: 'specter', countRange: [5, 10], difficulty: '困难' },
];
