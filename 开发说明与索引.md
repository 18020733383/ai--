# 开发说明与索引

## 项目概览
- 技术栈：React + TypeScript + Vite
- 单页应用，主要业务集中在 App.tsx
- 战斗、招募、存档、英雄系统均为前端状态管理

## 运行与构建
- 开发：`npm run dev`
- 构建：`npm run build`
- 预览：`npm run preview`

## 目录索引
- App.tsx：主应用逻辑与 UI 渲染
- constants.ts：兵种模板、据点数据、初始状态
- types.ts：类型定义（Troop、Hero、Location、BattleResult 等）
- services/geminiService.ts：战斗演算与亡灵对话
- components/：基础组件（按钮、兵种卡、更新日志弹窗）
- data/changelog.ts：更新日志数据源
- image/：据点背景图资源

## 核心数据结构
- PlayerState：主角属性、部队、位置、生命与状态
- Troop：兵种模板实例（count、xp 等）
- Hero：英雄角色数据与成长、血量、状态
- Location：据点基础信息、招募池、占领与建设
- BattleResult：战斗演算输出（回合、伤亡、结局、奖励）

## 主要流程索引
### 地图与据点
- 入口渲染：App.tsx 内视图切换与据点 UI
- 据点列表定位：App.tsx 内地图据点列表与快速定位逻辑

### 招募与酒馆
- 志愿兵与雇佣兵：App.tsx 内招募池更新与购买逻辑
- 英雄招募：酒馆视图中渲染英雄、对话与加入队伍

### 战斗与战前部署
- 战前部署：battlePlan 层级与拖拽分配
- 战斗演算：services/geminiService.ts 的 resolveBattle
- 战斗结算：App.tsx 内伤亡、经验、金钱与重伤处理

### 英雄系统
- 英雄生成与流动：App.tsx 初始化与每日循环
- 参战条件与战斗力：血量比例影响战斗力
- 升级与加点：calculateXpGain 与英雄属性点分配

### 每日循环
- processDailyCycle：处理日结事件、收入、治疗、英雄流动

### 存档与读取
- buildSaveData / importSaveData：序列化与载入状态

## 开发建议
- 业务逻辑集中在 App.tsx，修改前先定位对应流程
- 新增兵种优先扩展 constants.ts 的 TROOP_TEMPLATES
- 调整战斗结果格式需同步 services/geminiService.ts 的 schema
- 每次修改代码结束，请在 data/changelog.ts 追加版本记录
